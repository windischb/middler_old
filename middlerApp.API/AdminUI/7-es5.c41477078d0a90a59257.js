function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],c=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(c=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);c=!0);}catch(a){r=!0,i=a}finally{try{c||null==l.return||l.return()}finally{if(r)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,c=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(c,arguments,r)}else n=c.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{oWrh:function(e,t,n){"use strict";n.r(t),n.d(t,"EndpointRulesModule",(function(){return ut}));var c=n("ofXK"),r=n("tyNb"),i=n("fXoL"),o=n("ZF+8"),l=n("xr/A"),a=n("vkgz"),s=n("2Vo4"),u=function(){function e(t){_classCallCheck(this,e),this.Item=t,this._showDetails=!1,this.ShowDetailsSubject$=new s.a(!1),this.ShowDetails$=this.ShowDetailsSubject$.asObservable()}return _createClass(e,[{key:"ShowDetails",set:function(e){this._showDetails=e,this.ShowDetailsSubject$.next(this._showDetails)},get:function(){return this._showDetails}}]),e}(),d=n("5+WD"),f=function(){function e(){_classCallCheck(this,e),this.AllItems=[],this.Selected=[]}return _createClass(e,[{key:"Single",get:function(){var e;return 1===(null===(e=this.Selected)||void 0===e?void 0:e.length)?this.Selected[0]:null}},{key:"IsFirst",get:function(){return this.Single?this.AllItems[0].Id===this.Single.Id:null}},{key:"IsLast",get:function(){return this.Single?this.AllItems[this.AllItems.length-1].Id===this.Single.Id:null}}]),e}(),h=n("GH2U"),g=n("h0m+"),p=function e(){_classCallCheck(this,e),this.Enabled=!1},m=function e(){_classCallCheck(this,e),this.RewriteTo=""},b=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).ActionType="UrlRewrite",e.Parameters=new m,e}return n}(p),v=n("3Pt+"),y=n("t7qs"),C=n("OzZK"),k=n("RwU8"),x=n("C2AL");function S(e,t){1&e&&(i.gc(0,"div"),i.Sc(1,"Action"),i.fc())}var O,M=["*"],I=((O=function e(){_classCallCheck(this,e),this.ok=new i.q,this.cancel=new i.q}).\u0275fac=function(e){return new(e||O)},O.\u0275cmp=i.Ub({type:O,selectors:[["action-basic-modal"]],hostAttrs:[1,"flex-grow-column"],inputs:{form:"form"},outputs:{ok:"ok",cancel:"cancel"},ngContentSelectors:M,decls:15,vars:2,consts:[[1,"modal-header",2,"padding","10px !important","display","flex"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],["dbPortal","ActionModalHeader-Left",1,"Irgendwos"],["left","dbPortal"],[4,"ngIf"],[2,"flex-grow","1"],["dbPortal","ActionModalHeader-Right"],[1,"modal-content",2,"padding-bottom","10px"],[1,"modal-footer",2,"margin-bottom","0px"],["nz-button","","nzType","primary","nzBlock","",2,"margin-right","1px",3,"disabled","click"],["nz-button","","nzType","default","nzBlock","",1,"secondary",2,"margin-left","1px",3,"click"]],template:function(e,t){if(1&e&&(i.xc(),i.gc(0,"div",0),i.gc(1,"div",1),i.cc(2,2,3),i.Qc(4,S,2,0,"div",4),i.fc(),i.bc(5,"div",5),i.gc(6,"div"),i.cc(7,6),i.fc(),i.fc(),i.gc(8,"div",7),i.wc(9),i.fc(),i.gc(10,"div",8),i.gc(11,"button",9),i.oc("click",(function(){return t.ok.next()})),i.Sc(12,"Save"),i.fc(),i.gc(13,"button",10),i.oc("click",(function(){return t.cancel.next()})),i.Sc(14,"Close"),i.fc(),i.fc()),2&e){var n=i.Gc(3);i.Mb(4),i.yc("ngIf",!n.hasSource),i.Mb(7),i.yc("disabled",!t.form.valid)}},directives:[y.d,c.t,C.a,k.a,x.a],styles:[".modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important;border:1px solid #fff!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-footer[_ngcontent-%COMP%]{padding:8px}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;padding:8px 8px 0}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ng-component[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}action-basic-modal[_ngcontent-%COMP%]   div[name][_ngcontent-%COMP%]{min-height:1.28571429em}action-basic-modal[_ngcontent-%COMP%]{box-shadow:3px 3px 5px 0 #333}"]}),O),w=n("ocnv"),_=n("B+r4"),z=n("PTRe");function P(e,t){1&e&&i.Sc(0," Url - Rewrite ")}var A,R=((A=function(){function e(t,n){_classCallCheck(this,e),this.fb=t,this.context=n}return _createClass(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({RewriteTo:[]}),this.form.patchValue(this.context.data.Parameters)}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||A)(i.ac(v.d),i.ac(g.d))},A.\u0275cmp=i.Ub({type:A,selectors:[["ng-component"]],decls:7,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RewriteTo"],["nz-input","","formControlName","RewriteTo","id","RewriteTo",2,"width","100%"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(i.gc(0,"action-basic-modal",0),i.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),i.gc(1,"form",1),i.gc(2,"nz-form-label",2),i.Sc(3,"RewriteTo"),i.fc(),i.gc(4,"nz-form-control"),i.bc(5,"input",3),i.fc(),i.Qc(6,P,1,0,"ng-template",4),i.fc(),i.fc()),2&e&&(i.yc("form",t.form),i.Mb(1),i.yc("formGroup",t.form))},directives:[I,v.q,v.m,w.b,v.g,_.a,w.d,w.a,z.b,v.c,v.l,v.f,y.e],styles:[""]}),A),T=function e(){_classCallCheck(this,e),this.RedirectTo="",this.Permanent=!1,this.PreserveMethod=!0},D=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).ActionType="UrlRedirect",e.Parameters=new T,e}return n}(p),H=n("TaO5");function L(e,t){1&e&&i.Sc(0," Url - Redirect ")}var F,B=((F=function(){function e(t,n){_classCallCheck(this,e),this.fb=t,this.context=n}return _createClass(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({RedirectTo:[],Permanent:[],PreserveMethod:[]}),this.form.patchValue(this.context.data.Parameters)}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||F)(i.ac(v.d),i.ac(g.d))},F.\u0275cmp=i.Ub({type:F,selectors:[["ng-component"]],decls:14,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RedirectTo"],["nz-input","","formControlName","RedirectTo","id","RedirectTo",2,"width","100%"],[2,"display","flex","flex-direction","row"],[1,"field"],["nz-checkbox","","formControlName","PreserveMethod"],["nz-checkbox","","formControlName","Permanent"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(i.gc(0,"action-basic-modal",0),i.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),i.gc(1,"form",1),i.gc(2,"nz-form-label",2),i.Sc(3,"RedirectTo"),i.fc(),i.gc(4,"nz-form-control"),i.bc(5,"input",3),i.fc(),i.gc(6,"div",4),i.gc(7,"div",5),i.gc(8,"label",6),i.Sc(9,"PreserveMethod"),i.fc(),i.fc(),i.gc(10,"div",5),i.gc(11,"label",7),i.Sc(12,"Permanent"),i.fc(),i.fc(),i.fc(),i.Qc(13,L,1,0,"ng-template",8),i.fc(),i.fc()),2&e&&(i.yc("form",t.form),i.Mb(1),i.yc("formGroup",t.form))},directives:[I,v.q,v.m,w.b,v.g,_.a,w.d,w.a,z.b,v.c,v.l,v.f,H.a,y.e],styles:[".field[_ngcontent-%COMP%]{padding-top:5px}"]}),F),U=function e(){_classCallCheck(this,e),this.Language="Typescript"},G=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).ActionType="Script",e.Parameters=new U,e}return n}(p),E=n("jfkr"),j=n("zAKX");function Q(e,t){1&e&&i.Sc(0," Script ")}function N(e,t){1&e&&(i.gc(0,"div",6),i.gc(1,"div",7),i.gc(2,"nz-select",8),i.bc(3,"nz-option",9),i.bc(4,"nz-option",10),i.bc(5,"nz-option",11),i.fc(),i.fc(),i.fc())}var V,q,W=function(){return{noLib:!0}},K=((q=function(){function e(t,n,c){_classCallCheck(this,e),this.fb=t,this.context=n,this.rulesService=c,this.typings$=this.rulesService.typings$.pipe(Object(a.a)((function(e){return console.log(e)})))}return _createClass(e,[{key:"ngOnInit",value:function(){this.form=this.fb.group({Language:[],SourceCode:[]}),this.context.data.Parameters.Language||(this.context.data.Parameters.Language="Typescript"),this.form.patchValue(this.context.data.Parameters)}},{key:"initRestrictionsAccordion",value:function(e){$(e.nativeElement).accordion()}},{key:"ok",value:function(){this.context.invoke("OK",this.form.value)}},{key:"cancel",value:function(){this.context.handle.Close()}}]),e}()).\u0275fac=function(e){return new(e||q)(i.ac(v.d),i.ac(g.d),i.ac(h.a))},q.\u0275cmp=i.Ub({type:q,selectors:[["ng-component"]],decls:7,vars:8,consts:[[3,"form","ok","cancel"],["nz-form","",1,"flex-grow-column",2,"width","100%",3,"formGroup"],[1,"field","flex-grow-column"],["formControlName","SourceCode",3,"language","typings","tsOptions"],["dbPortalTemplate","ActionModalHeader-Left"],["dbPortalTemplate","ActionModalHeader-Right"],[1,"fields"],[2,"width","180px"],["formControlName","Language",2,"width","100%"],["nzLabel","Typescript","nzValue","Typescript"],["nzLabel","Javascript","nzValue","Javascript"],["nzLabel","Powershell","nzValue","Powershell"]],template:function(e,t){1&e&&(i.gc(0,"action-basic-modal",0),i.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),i.gc(1,"form",1),i.gc(2,"div",2),i.bc(3,"db-editor",3),i.sc(4,"async"),i.fc(),i.Qc(5,Q,1,0,"ng-template",4),i.Qc(6,N,6,0,"ng-template",5),i.fc(),i.fc()),2&e&&(i.yc("form",t.form),i.Mb(1),i.yc("formGroup",t.form),i.Mb(2),i.yc("language",t.form.value.Language)("typings",i.tc(4,5,t.typings$))("tsOptions",i.Ac(7,W)))},directives:[I,v.q,v.m,w.b,v.g,E.a,v.l,v.f,y.e,j.b,j.a],pipes:[c.b],styles:[""]}),q),J=((V=function(){function e(t,n){_classCallCheck(this,e),this.modal=t,this.componentFactoryResolver=n}return _createClass(e,[{key:"GetIcon",value:function(e){switch(e.ActionType){case"UrlRedirect":return"rollback";case"UrlRewrite":return"edit";case"Proxy":return"fa#random";case"Script":return"code"}return"hat wizard"}},{key:"GetModal",value:function(e){switch(e.toLowerCase()){case"urlredirect":return this.modal.FromComponent(B).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"urlrewrite":return this.modal.FromComponent(R).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"script":return this.modal.FromComponent(K).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"80%",height:"90%"}}).CloseOnOutsideClick()}}}]),e}()).\u0275fac=function(e){return new(e||V)(i.kc(g.b),i.kc(i.k))},V.\u0275prov=i.Wb({token:V,factory:V.\u0275fac,providedIn:"root"}),V),X=n("gPmL"),Y=n("nJia"),Z=n("Q8cG"),ee=["contextMenu"],te=["addRuleTemplate"];function ne(e,t){1&e&&(i.gc(0,"div",8),i.gc(1,"div",9),i.Sc(2,"Currently there is nothing..."),i.fc(),i.gc(3,"p"),i.Sc(4,"Use the ContextMenu to create your first rule!"),i.fc(),i.fc())}function ce(e,t){if(1&e&&(i.gc(0,"span",19),i.bc(1,"db-icon",20),i.fc()),2&e){var n=t.$implicit,c=i.rc(2);i.yc("nzTooltipTitle",n.ActionType),i.Mb(1),i.yc("icon",c.GetIcon(n))}}function re(e,t){if(1&e){var n=i.hc();i.gc(0,"div",10),i.oc("click",(function(e){i.Ic(n);var c=t.$implicit;return i.rc().clickAction(e,c)}))("contextmenu",(function(e){i.Ic(n);var c=t.$implicit,r=i.rc(),o=i.Gc(11);return r.openItemContextMenu(e,o,c)}))("dblclick",(function(){i.Ic(n);var e=t.$implicit;return i.rc().editRule(e.Item.Id)})),i.gc(1,"div",11),i.gc(2,"div",12),i.bc(3,"db-icon",13),i.fc(),i.gc(4,"div",14),i.gc(5,"div",15),i.Sc(6),i.fc(),i.gc(7,"div"),i.Sc(8),i.fc(),i.fc(),i.gc(9,"div",16),i.gc(10,"div"),i.Sc(11),i.fc(),i.gc(12,"div"),i.Sc(13),i.fc(),i.fc(),i.gc(14,"div",17),i.gc(15,"div"),i.Sc(16),i.fc(),i.Qc(17,ce,2,2,"span",18),i.fc(),i.fc(),i.fc()}if(2&e){var c=t.$implicit;i.Sb("selected",c.Selected)("disabled",!c.Item.Enabled),i.Mb(6),i.Tc(c.Item.Name),i.Mb(2),i.Tc(c.Item.Path),i.Mb(3),i.Tc(c.Item.Scheme),i.Mb(2),i.Tc(c.Item.Hostname),i.Mb(3),i.Uc(" ",(null==c.Item.Actions?null:c.Item.Actions.length)||0," Actions "),i.Mb(1),i.yc("ngForOf",c.Item.Actions)}}function ie(e,t){if(1&e){var n=i.hc();i.gc(0,"ul",21),i.gc(1,"li",22),i.gc(2,"ul",23),i.gc(3,"li",24),i.oc("click",(function(){return i.Ic(n),i.rc().CreateRuleOnTop()})),i.bc(4,"db-icon",25),i.Sc(5," Top "),i.fc(),i.gc(6,"li",24),i.oc("click",(function(){return i.Ic(n),i.rc().CreateRuleOnBottom()})),i.bc(7,"db-icon",26),i.Sc(8," Bottom "),i.fc(),i.fc(),i.fc(),i.fc()}}function oe(e,t){if(1&e){var n=i.hc();i.gc(0,"li",24),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().SetRuleEnabled(e.Single,!0)})),i.bc(1,"db-icon",31),i.Sc(2," Enable "),i.fc()}}function le(e,t){if(1&e){var n=i.hc();i.gc(0,"li",24),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().SetRuleEnabled(e.Single,!1)})),i.bc(1,"db-icon",32),i.Sc(2," Disable "),i.fc()}}function ae(e,t){if(1&e){var n=i.hc();i.gc(0,"li",22),i.gc(1,"ul",23),i.gc(2,"li",24),i.oc("click",(function(){return i.Ic(n),i.rc(2).CreateRuleOnTop()})),i.bc(3,"db-icon",25),i.Sc(4," Top "),i.fc(),i.gc(5,"li",24),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateRuleBefore(e.Single)})),i.bc(6,"db-icon",33),i.Sc(7," Before "),i.fc(),i.gc(8,"li",24),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateRuleAfter(e.Single)})),i.bc(9,"db-icon",34),i.Sc(10," After "),i.fc(),i.gc(11,"li",24),i.oc("click",(function(){return i.Ic(n),i.rc(2).CreateRuleOnBottom()})),i.bc(12,"db-icon",26),i.Sc(13," Bottom "),i.fc(),i.fc(),i.fc()}}function se(e,t){if(1&e){var n=i.hc();i.gc(0,"ul",21),i.Qc(1,oe,3,0,"li",27),i.Qc(2,le,3,0,"li",27),i.Qc(3,ae,14,0,"li",28),i.bc(4,"li",29),i.gc(5,"li",24),i.oc("click",(function(){i.Ic(n);var e=t.$implicit;return i.rc().RemoveRules(e.Selected)})),i.bc(6,"db-icon",30),i.Sc(7," Remove "),i.fc(),i.fc()}if(2&e){var c=t.$implicit;i.Mb(1),i.yc("ngIf",!1===(null==c.Single?null:c.Single.Enabled)),i.Mb(1),i.yc("ngIf",!0===(null==c.Single?null:c.Single.Enabled)),i.Mb(1),i.yc("ngIf",c.Single)}}var ue,de,fe=function(){return[]},he=((de=function(){function e(t,n,c,r,o,l,a){_classCallCheck(this,e),this.rulesService=t,this.cref=n,this.overlay=c,this.viewContainerRef=r,this.router=o,this.route=l,this.actionHelper=a,this._rules=[],this.rulesSubject$=new s.a(this._rules),this.rules$=this.rulesSubject$.asObservable(),this.rulesChanged=new i.q,this.selected=[],this.registered=[],this.onTouched=function(){}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.rulesService.MiddlerRules$.pipe(Object(a.a)((function(t){e.rules=t}))).subscribe()}},{key:"ngAfterViewInit",value:function(){}},{key:"clickAction",value:function(e,t){e.ctrlKey?t.Selected=!t.Selected:this._rules=this._rules.map((function(e){return e.Selected=e==t,e}))}},{key:"openOuterContextMenu",value:function(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}},{key:"openItemContextMenu",value:function(e,t,n){var c;e.stopPropagation();var r=this._rules.filter((function(e){return e.Selected}));0!=r.length&&r.includes(n)||(this._rules=this._rules.map((function(e){return e.Selected=e==n,e}))),null===(c=this.ContextMenu)||void 0===c||c.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}},{key:"DeSelectAll",value:function(){console.log("Deselect"),this._rules=this._rules.map((function(e){return e.Selected=!1,e}))}},{key:"SetRuleEnabled",value:function(e,t){this.rulesService.SetRuleEnabled(e,t)}},{key:"GetActionByIndex",value:function(e){return this.rules[e]}},{key:"GetActionById",value:function(e){return this.rules.find((function(t){return t.Id===e}))}},{key:"ClearSelection",value:function(){this.selected=[],this.cref.markForCheck()}},{key:"BuildContext",value:function(){var e=new f;return e.AllItems=this.rules,e.Selected=this._rules.filter((function(e){return e.Selected})).map((function(e){return e.Item})),e}},{key:"initContextMenu",value:function(e){}},{key:"CreateRuleOnTop",value:function(){var e=new l.a;e.Enabled=!1,e.Order=this.rules&&0!=this.rules.length?this.rules[0].Order/2:10,this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleBefore",value:function(e){var t=this.rules.findIndex((function(t){return t.Order===e.Order})),n=new l.a;n.Enabled=!1,n.Order=0==t?e.Order/2:e.Order-(e.Order-this.rules[t-1].Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleAfter",value:function(e){var t=this.rules.findIndex((function(t){return t.Order===e.Order})),n=new l.a;n.Enabled=!1,n.Order=t==this.rules.length-1?this.rulesService.GetNextLastOrder():e.Order+(this.rules[t+1].Order-e.Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}},{key:"CreateRuleOnBottom",value:function(){var e=new l.a;e.Enabled=!1,e.Order=this.rulesService.GetNextLastOrder(),this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}},{key:"RemoveRules",value:function(e){var t=this;e.forEach((function(e){return t.rulesService.Remove(e.Id).subscribe()})),this.ContextMenu.Close()}},{key:"SaveOrder",value:function(){this.rulesService.UpdateRulesOrder().subscribe()}},{key:"editRule",value:function(e){this.router.navigate([e],{relativeTo:this.route})}},{key:"calculateRuleOrder",value:function(e){if(0===this.rules.length)return 10;if(0===e)return this.rules[0].Order/2;if(e>=this.rules.length)return this.rulesService.GetNextLastOrder();var t=this.rules[e-1].Order;return(this.rules[e].Order-t)/2+t}},{key:"drop",value:function(e){if(e.previousContainer===e.container){var t=this.rulesService.MiddlerRules[e.previousIndex],n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),!n)return;if("forward"===n)if(e.currentIndex===this.rulesService.MiddlerRules.length-1)t.Order=this.rulesService.GetNextLastOrder();else{var c=this.rulesService.MiddlerRules[e.currentIndex];t.Order=(this.rulesService.MiddlerRules[e.currentIndex+1].Order-c.Order)/2+c.Order}else if("back"===n)if(0===e.currentIndex)t.Order=this.rulesService.MiddlerRules[0].Order/2;else{var r=this.rulesService.MiddlerRules[e.currentIndex-1];t.Order=(this.rulesService.MiddlerRules[e.currentIndex].Order-r.Order)/2+r.Order}Object(d.e)(this.rulesService.MiddlerRules,e.previousIndex,e.currentIndex),this.rulesService.MiddlerRules=_toConsumableArray(this.rulesService.MiddlerRules),this.SaveOrder()}else{var i=new l.a;i.Enabled=!1,console.log(e),i.Order=this.calculateRuleOrder(e.currentIndex),this.rulesService.Add(i).subscribe()}}},{key:"GetIcon",value:function(e){return this.actionHelper.GetIcon(e)}},{key:"prepareIcon",value:function(e){if(!e)return null;if(e.startsWith("fa#")){var t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}},{key:"propagateChange",value:function(e){this.rulesChanged.next(e),this.registered.forEach((function(t){t(e)}))}},{key:"writeValue",value:function(e){this.rules=e}},{key:"registerOnChange",value:function(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){throw new Error("Method not implemented.")}},{key:"rules",set:function(e){var t=this;this._rules=(e||[]).map((function(e){var n=t._rules.find((function(t){return t.Item.Id===e.Id}));return n?(n.Item=e,n):new u(e)})),this.rulesSubject$.next(this._rules)},get:function(){return this._rules.map((function(e){return e.Item}))}}]),e}()).\u0275fac=function(e){return new(e||de)(i.ac(h.a),i.ac(i.h),i.ac(g.c),i.ac(i.Y),i.ac(r.i),i.ac(r.a),i.ac(J))},de.\u0275cmp=i.Ub({type:de,selectors:[["enpoint-rules-list"]],viewQuery:function(e,t){var n;1&e&&(i.Xc(ee,!0),i.Xc(te,!0)),2&e&&(i.Fc(n=i.pc())&&(t.contextMenu=n.first),i.Fc(n=i.pc())&&(t.addRuleTemplate=n.first))},inputs:{rules:"rules"},outputs:{rulesChanged:"rulesChanged"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",1,"",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","rule-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","contextmenu","dblclick",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"rule-item",3,"click","contextmenu","dblclick"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["icon","fa#ellipsis-v",2,"width","1.18em","margin","0 .25rem 0 0","font-size","1.2em"],[2,"padding","5px","min-width","50%","max-width","50%"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[2,"padding","5px","min-width","200px","max-width","200px"],[2,"padding","5px"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngFor","ngForOf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"icon"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["icon","double-left","rotate","90"],["icon","double-right","rotate","90"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold",4,"ngIf"],["nz-menu-divider",""],["icon","delete"],["icon","fa#toggle-on"],["icon","fa#toggle-off"],["icon","up"],["icon","down"]],template:function(e,t){if(1&e){var n=i.hc();i.gc(0,"div",0,1),i.oc("contextmenu",(function(e){i.Ic(n);var c=i.Gc(9);return t.openOuterContextMenu(e,c)})),i.gc(2,"div",2,3),i.oc("cdkDropListDropped",(function(e){return t.drop(e)})),i.Qc(4,ne,5,0,"div",4),i.sc(5,"async"),i.Qc(6,re,18,10,"div",5),i.sc(7,"async"),i.fc(),i.fc(),i.Qc(8,ie,9,0,"ng-template",null,6,i.Rc),i.Qc(10,se,8,3,"ng-template",null,7,i.Rc)}2&e&&(i.Mb(4),i.yc("ngIf",0===(i.tc(5,2,t.rules$)||i.Ac(6,fe)).length),i.Mb(2),i.yc("ngForOf",i.tc(7,4,t.rules$)))},directives:[d.c,c.t,c.s,d.a,d.b,X.c,Y.b,Z.c,x.a,Z.g,Z.e,Z.d],pipes:[c.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.rule-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.rule-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.rule-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.rule-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.rule-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.rule-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.anticon.disabled[_ngcontent-%COMP%]{color:#ccc}"],changeDetection:0}),de),ge=((ue=function e(t){_classCallCheck(this,e),this.uiService=t,t.Set((function(e){e.Header.Title="Endpoint Rules",e.Content.Scrollable=!1,e.Header.Icon="fa#stream"}))}).\u0275fac=function(e){return new(e||ue)(i.ac(o.a))},ue.\u0275cmp=i.Ub({type:ue,selectors:[["ng-component"]],decls:2,vars:0,consts:[[2,"display","flex","flex-direction","column","flex-grow","1"]],template:function(e,t){1&e&&(i.gc(0,"div",0),i.bc(1,"enpoint-rules-list"),i.fc())},directives:[he],styles:[""]}),ue),pe=n("itXk"),me=n("lJxs"),be=n("bHdf"),ve=n("1zMv"),ye=n("oyxB"),Ce=n("IvDN"),ke=["urlredirect"],xe=["urlrewrite"],Se=["script"];function Oe(e,t){if(1&e&&(i.gc(0,"div"),i.Sc(1),i.fc(),i.gc(2,"div"),i.Sc(3),i.fc(),i.gc(4,"div"),i.Sc(5),i.fc()),2&e){var n=i.rc();i.Mb(1),i.Uc(" Redirect to ",n.action.Parameters.RedirectTo," "),i.Mb(2),i.Uc(" Permanent: ",n.action.Parameters.Permanent," "),i.Mb(2),i.Uc(" PreserveMethod: ",n.action.Parameters.PreserveMethod," ")}}function Me(e,t){if(1&e&&(i.gc(0,"div"),i.Sc(1),i.fc()),2&e){var n=i.rc();i.Mb(1),i.Uc(" Rewrite to ",n.action.Parameters.RewriteTo," ")}}function Ie(e,t){if(1&e&&(i.gc(0,"div"),i.Sc(1),i.fc()),2&e){var n=i.rc();i.Mb(1),i.Uc(" ",n.action.Parameters.Language," ")}}var we,_e=((we=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){this.template=this.determineTemplate()}},{key:"determineTemplate",value:function(){switch(this.action.ActionType){case"UrlRedirect":return this.UrlRedirect;case"UrlRewrite":return this.UrlRewrite;case"Script":return this.Script}}}]),e}()).\u0275fac=function(e){return new(e||we)},we.\u0275cmp=i.Ub({type:we,selectors:[["action-list-details"]],viewQuery:function(e,t){var n;1&e&&(i.Oc(ke,!0),i.Oc(xe,!0),i.Oc(Se,!0)),2&e&&(i.Fc(n=i.pc())&&(t.UrlRedirect=n.first),i.Fc(n=i.pc())&&(t.UrlRewrite=n.first),i.Fc(n=i.pc())&&(t.Script=n.first))},inputs:{action:"action"},decls:8,vars:1,consts:[[2,"font-size","x-small"],[3,"ngTemplateOutlet"],["urlredirect",""],["urlrewrite",""],["script",""]],template:function(e,t){1&e&&(i.gc(0,"div",0),i.cc(1,1),i.fc(),i.Qc(2,Oe,6,3,"ng-template",null,2,i.Rc),i.Qc(4,Me,2,1,"ng-template",null,3,i.Rc),i.Qc(6,Ie,2,1,"ng-template",null,4,i.Rc)),2&e&&(i.Mb(1),i.yc("ngTemplateOutlet",t.template))},directives:[c.A],styles:[""]}),we),ze=n("FwiY"),Pe=n("6NWb");function Ae(e,t){1&e&&(i.gc(0,"div",8),i.gc(1,"div",9),i.Sc(2,"Currently there is nothing..."),i.fc(),i.gc(3,"p"),i.Sc(4,"Use the ContextMenu to create your first action!"),i.fc(),i.fc())}function Re(e,t){if(1&e&&i.bc(0,"i",20),2&e){var n=i.rc().$implicit;i.yc("nzType",n.icon)}}function Te(e,t){if(1&e&&i.bc(0,"fa-icon",21),2&e){var n=i.rc().$implicit;i.yc("icon",n.icon)}}function De(e,t){if(1&e&&(i.gc(0,"div",17),i.Qc(1,Re,1,1,"i",18),i.Qc(2,Te,1,1,"fa-icon",19),i.fc()),2&e){var n=t.$implicit;i.Mb(1),i.yc("ngIf","ant"==n.type),i.Mb(1),i.yc("ngIf","fa"==n.type)}}function He(e,t){if(1&e){var n=i.hc();i.gc(0,"div",10),i.oc("click",(function(e){i.Ic(n);var c=t.$implicit;return i.rc().ClickAction(e,c)}))("dblclick",(function(){i.Ic(n);var e=t.$implicit;return i.rc().openModal(e)}))("contextmenu",(function(e){i.Ic(n);var c=t.$implicit,r=i.rc(),o=i.Gc(11);return r.openItemContextMenu(e,o,c)})),i.gc(1,"div",11),i.gc(2,"div",12),i.Qc(3,De,3,2,"div",13),i.fc(),i.gc(4,"div",14),i.gc(5,"div",15),i.Sc(6),i.fc(),i.bc(7,"action-list-details",16),i.fc(),i.fc(),i.fc()}if(2&e){var c=t.$implicit,r=i.rc();i.Sb("selected",r.IsActionSelected(c))("disabled",!c.Enabled),i.Mb(3),i.yc("ngIf",r.prepareIcon(r.GetIcon(c))),i.Mb(3),i.Tc(c.ActionType),i.Mb(1),i.yc("action",c)}}function Le(e,t){if(1&e){var n=i.hc();i.gc(0,"ul",22),i.gc(1,"li",23),i.gc(2,"ul",24),i.gc(3,"li",25),i.oc("click",(function(){return i.Ic(n),i.rc().CreateAction("UrlRedirect","bottom")})),i.bc(4,"i",26),i.Sc(5," UrlRedirect "),i.fc(),i.gc(6,"li",25),i.oc("click",(function(){return i.Ic(n),i.rc().CreateAction("UrlRewrite","bottom")})),i.bc(7,"i",27),i.Sc(8," UrlRewrite "),i.fc(),i.gc(9,"li",25),i.oc("click",(function(){return i.Ic(n),i.rc().CreateAction("Script","bottom")})),i.bc(10,"i",28),i.Sc(11," Script "),i.fc(),i.fc(),i.fc(),i.fc()}}var $e=function(){return["fas","toggle-on"]};function Fe(e,t){if(1&e){var n=i.hc();i.gc(0,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().SetActionEnabled(e.Single,!0)})),i.bc(1,"fa-icon",34),i.Sc(2," Enable "),i.fc()}2&e&&(i.Mb(1),i.yc("icon",i.Ac(1,$e)))}var Be=function(){return["fas","toggle-off"]};function Ue(e,t){if(1&e){var n=i.hc();i.gc(0,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().SetActionEnabled(e.Single,!1)})),i.bc(1,"fa-icon",34),i.Sc(2," Disable "),i.fc()}2&e&&(i.Mb(1),i.yc("icon",i.Ac(1,Be)))}function Ge(e,t){if(1&e){var n=i.hc();i.gc(0,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().openModal(e.Single)})),i.bc(1,"i",35),i.Sc(2," Edit "),i.fc()}}function Ee(e,t){if(1&e){var n=i.hc();i.gc(0,"li",36),i.gc(1,"ul",24),i.gc(2,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("UrlRedirect","before",e.Single)})),i.bc(3,"i",26),i.Sc(4," UrlRedirect "),i.fc(),i.gc(5,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("UrlRewrite","before",e.Single)})),i.bc(6,"i",27),i.Sc(7," UrlRewrite "),i.fc(),i.gc(8,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("Script","before",e.Single)})),i.bc(9,"i",28),i.Sc(10," Script "),i.fc(),i.fc(),i.fc()}}function je(e,t){if(1&e){var n=i.hc();i.gc(0,"li",37),i.gc(1,"ul",24),i.gc(2,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("UrlRedirect","after",e.Single)})),i.bc(3,"i",26),i.Sc(4," UrlRedirect "),i.fc(),i.gc(5,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("UrlRewrite","after",e.Single)})),i.bc(6,"i",27),i.Sc(7," UrlRewrite "),i.fc(),i.gc(8,"li",25),i.oc("click",(function(){i.Ic(n);var e=i.rc().$implicit;return i.rc().CreateAction("Script","after",e.Single)})),i.bc(9,"i",28),i.Sc(10," Script "),i.fc(),i.fc(),i.fc()}}function Qe(e,t){if(1&e){var n=i.hc();i.gc(0,"ul",22),i.Qc(1,Fe,3,2,"li",29),i.Qc(2,Ue,3,2,"li",29),i.Qc(3,Ge,3,0,"li",29),i.Qc(4,Ee,11,0,"li",30),i.Qc(5,je,11,0,"li",31),i.bc(6,"li",32),i.gc(7,"li",25),i.oc("click",(function(){i.Ic(n);var e=t.$implicit;return i.rc().RemoveActions(e.Selected)})),i.bc(8,"i",33),i.Sc(9," Remove "),i.fc(),i.fc()}if(2&e){var c=t.$implicit;i.Mb(1),i.yc("ngIf",!1===(null==c.Single?null:c.Single.Enabled)),i.Mb(1),i.yc("ngIf",!0===(null==c.Single?null:c.Single.Enabled)),i.Mb(1),i.yc("ngIf",c.Single),i.Mb(1),i.yc("ngIf",c.Single),i.Mb(1),i.yc("ngIf",c.Single)}}var Ne,Ve=function(){return[]},qe=((Ne=function(){function e(t,n,c,r,i,o,l,a){_classCallCheck(this,e),this.uiService=t,this.modal=n,this.overlay=c,this.viewContainerRef=r,this.cref=i,this.componentFactoryResolver=o,this.actionHelper=l,this.rulesService=a,this.actionsSubject$=new s.a(null),this.actions$=this.actionsSubject$.asObservable(),this.selectedActions=[]}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.rulesService.GetActionsForRule(this.ruleId).subscribe((function(t){e.actions=t}))}},{key:"IsActionSelected",value:function(e){return this.selectedActions.includes(e.Id)}},{key:"setActionSelected",value:function(e,t){this.selectedActions=t?_toConsumableArray(new Set([].concat(_toConsumableArray(this.selectedActions),[e.Id]))):this.selectedActions.filter((function(t){return t!=e.Id}))}},{key:"GetSelectedActions",value:function(){var e=this;return this.actions.filter((function(t){return e.selectedActions.includes(t.Id)}))}},{key:"ClickAction",value:function(e,t){if(e.ctrlKey){var n=this.IsActionSelected(t);this.setActionSelected(t,!n)}else this.selectedActions=[],this.setActionSelected(t,!0)}},{key:"OpenOuterContextMenu",value:function(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}},{key:"openItemContextMenu",value:function(e,t,n){var c;e.stopPropagation(),0!=this.selectedActions.length&&this.IsActionSelected(n)||this.setActionSelected(n,!0),null===(c=this.ContextMenu)||void 0===c||c.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}},{key:"BuildContext",value:function(){var e=this,t=new f;return t.AllItems=this.actions,t.Selected=this.actions.filter((function(t){return e.selectedActions.includes(t.Id)})),t}},{key:"GetIcon",value:function(e){return this.actionHelper.GetIcon(e)}},{key:"prepareIcon",value:function(e){if(!e)return null;if(e.startsWith("fa#")){var t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}},{key:"CreateAction",value:function(e,t,n){var c=new p;switch(e.toLowerCase()){case"urlredirect":c=new D;break;case"urlrewrite":c=new b;break;case"script":c=new G}c.Order=this.CalculateOrder(t,n),this.rulesService.AddAction(this.ruleId,c).subscribe()}},{key:"GetLastNextOrder",value:function(){return this.actions&&0!==this.actions.length?Math.trunc(Math.max.apply(Math,_toConsumableArray(this.actions.map((function(e){return e.Order}))))+10):10}},{key:"CalculateOrder",value:function(e,t){var n,c=null===(n=this.actions)||void 0===n?void 0:n.findIndex((function(e){return e.Order===t.Order}));switch(e){case"top":return this.actions&&0!=this.actions.length?this.actions[0].Order/2:10;case"before":return 0==c?t.Order/2:t.Order-(t.Order-this.actions[c-1].Order)/2;case"after":return c==this.actions.length-1?this.GetLastNextOrder():t.Order+(this.actions[c+1].Order-t.Order)/2;case"bottom":return this.GetLastNextOrder()}}},{key:"SetActionEnabled",value:function(e,t){var n=this;this.rulesService.SetActionEnabled(this.ruleId,e,t).subscribe((function(c){n.actions=n.actions.map((function(n){return n==e&&(n.Enabled=t),n}))}))}},{key:"RemoveActions",value:function(e){var t,n,c=this,r=e.map((function(e){return e.Id}));(t=this.rulesService).RemoveActions.apply(t,[this.ruleId].concat(_toConsumableArray(r))).subscribe((function(e){c.actions=c.actions.filter((function(e){return!r.includes(e.Id)}))})),null===(n=this.ContextMenu)||void 0===n||n.Close()}},{key:"drop",value:function(e){var t=this.actions[e.previousIndex],n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),n){if("forward"===n)if(e.currentIndex===this.actions.length-1)t.Order=this.rulesService.GetNextLastOrder();else{var c=this.actions[e.currentIndex];t.Order=(this.actions[e.currentIndex+1].Order-c.Order)/2+c.Order}else if("back"===n)if(0===e.currentIndex)t.Order=this.actions[0].Order/2;else{var r=this.actions[e.currentIndex-1];t.Order=(this.actions[e.currentIndex].Order-r.Order)/2+r.Order}Object(d.e)(this.actions,e.previousIndex,e.currentIndex),this.actions=_toConsumableArray(this.actions),this.rulesService.UpdateActionsOrder(this.ruleId,this.actions).subscribe()}}},{key:"generatePatchDocument",value:function(e,t){return Object(ve.a)(e,t)}},{key:"openModal",value:function(e){var t,n=this;null===(t=this.ContextMenu)||void 0===t||t.Close();var c=Object.assign({},e);switch(e.ActionType){case"UrlRedirect":this.actionHelper.GetModal("UrlRedirect").SetData(e).AddEventHandler("OK",(function(t){e.Parameters=t.payload;var r=n.generatePatchDocument(c,e);n.rulesService.PatchAction(n.ruleId,c.Id,r).subscribe((function(e){n.actions=_toConsumableArray(n.actions)}))})).Open();break;case"UrlRewrite":this.actionHelper.GetModal("UrlRewrite").SetData(e).AddEventHandler("OK",(function(t){e.Parameters=t.payload;var r=n.generatePatchDocument(c,e);n.rulesService.PatchAction(n.ruleId,c.Id,r).subscribe((function(e){n.actions=_toConsumableArray(n.actions)}))})).Open();break;case"Script":this.actionHelper.GetModal("Script").SetData(e).AddEventHandler("OK",(function(t){e.Parameters=t.payload;var r=n.generatePatchDocument(c,e);n.rulesService.PatchAction(n.ruleId,c.Id,r).subscribe((function(e){n.actions=_toConsumableArray(n.actions)}))})).Open()}}},{key:"actions",get:function(){return this.actionsSubject$.value},set:function(e){e=null==e?void 0:e.sort((function(e,t){return e.Order>t.Order?1:e.Order<t.Order?-1:0})),this.actionsSubject$.next(e)}}]),e}()).\u0275fac=function(e){return new(e||Ne)(i.ac(o.a),i.ac(g.b),i.ac(g.c),i.ac(i.Y),i.ac(i.h),i.ac(i.k),i.ac(J),i.ac(h.a))},Ne.\u0275cmp=i.Ub({type:Ne,selectors:[["endpoint-actions-list"]],inputs:{ruleId:"ruleId"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","action-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","dblclick","contextmenu",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"action-item",3,"click","dblclick","contextmenu"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["class","title-icon",4,"ngIf"],[2,"padding","5px","min-width","50%","max-width","50%"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[3,"action"],[1,"title-icon"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","","nzTheme","outline",3,"nzType",4,"ngIf"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","",3,"icon",4,"ngIf"],["nz-icon","","nzTheme","outline",2,"font-size","xx-large","width","40px","text-align","left",3,"nzType"],["nz-icon","",2,"font-size","xx-large","width","40px","text-align","left",3,"icon"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Action","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","rollback","nzTheme","outline"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-icon","","nzType","code","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up",4,"ngIf"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down",4,"ngIf"],["nz-menu-divider",""],["nz-icon","","nzType","delete","nzTheme","outline"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down"]],template:function(e,t){if(1&e){var n=i.hc();i.gc(0,"div",0,1),i.oc("contextmenu",(function(e){i.Ic(n);var c=i.Gc(9);return t.OpenOuterContextMenu(e,c)})),i.gc(2,"div",2,3),i.oc("cdkDropListDropped",(function(e){return t.drop(e)})),i.Qc(4,Ae,5,0,"div",4),i.sc(5,"async"),i.Qc(6,He,8,7,"div",5),i.sc(7,"async"),i.fc(),i.fc(),i.Qc(8,Le,12,0,"ng-template",null,6,i.Rc),i.Qc(10,Qe,10,5,"ng-template",null,7,i.Rc)}2&e&&(i.Mb(4),i.yc("ngIf",0===(i.tc(5,2,t.actions$)||i.Ac(6,Ve)).length),i.Mb(2),i.yc("ngForOf",i.tc(7,4,t.actions$)))},directives:[d.c,c.t,c.s,d.a,d.b,_e,ze.b,x.a,Pe.b,Z.c,Z.g,Z.e,Z.d],pipes:[c.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.action-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.action-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.action-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.action-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.action-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.action-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}"],changeDetection:0}),Ne);function We(e,t){1&e&&(i.bc(0,"i",32),i.Sc(1,"Basic "))}function Ke(e,t){1&e&&(i.gc(0,"span"),i.Sc(1,"Enabled"),i.fc())}function Je(e,t){1&e&&(i.gc(0,"span"),i.Sc(1,"Disabled"),i.fc())}function Xe(e,t){1&e&&(i.bc(0,"i",33),i.Sc(1,"Actions"))}function Ye(e,t){1&e&&(i.bc(0,"i",36),i.Sc(1,"Debug"))}function Ze(e,t){if(1&e&&(i.gc(0,"nz-tab",3),i.Qc(1,Ye,2,0,"ng-template",null,34,i.Rc),i.gc(3,"div",35),i.gc(4,"pre"),i.Sc(5),i.sc(6,"json"),i.fc(),i.fc(),i.fc()),2&e){var n=i.Gc(2),c=i.rc(2);i.yc("nzTitle",n),i.Mb(5),i.Tc(i.tc(6,2,c.form.value))}}var et=function(){return{inkBar:!0,tabPane:!1}},tt=function(){return[","]};function nt(e,t){if(1&e){var n=i.hc();i.ec(0),i.gc(1,"form",1),i.gc(2,"nz-tabset",2),i.oc("nzSelectChange",(function(e){return i.Ic(n),i.rc().tabChanged(e)})),i.gc(3,"nz-tab",3),i.Qc(4,We,2,0,"ng-template",null,4,i.Rc),i.gc(6,"div",5),i.gc(7,"div",6),i.gc(8,"nz-form-label",7),i.Sc(9,"Name"),i.fc(),i.gc(10,"nz-form-control"),i.bc(11,"input",8),i.fc(),i.gc(12,"nz-form-label",9),i.Sc(13,"Path"),i.fc(),i.gc(14,"nz-form-control"),i.bc(15,"input",10),i.fc(),i.gc(16,"nz-form-label",11),i.Sc(17,"Hostname"),i.fc(),i.gc(18,"nz-form-control"),i.bc(19,"input",12),i.fc(),i.fc(),i.bc(20,"div",13),i.gc(21,"div",14),i.gc(22,"nz-collapse",15),i.gc(23,"nz-collapse-panel",16),i.gc(24,"label",17),i.Qc(25,Ke,2,0,"span",0),i.Qc(26,Je,2,0,"span",0),i.fc(),i.fc(),i.gc(27,"nz-collapse-panel",18),i.gc(28,"nz-select",19),i.bc(29,"nz-option",20),i.bc(30,"nz-option",21),i.fc(),i.fc(),i.gc(31,"nz-collapse-panel",22),i.gc(32,"nz-form-control"),i.gc(33,"nz-select",23),i.bc(34,"nz-option",24),i.bc(35,"nz-option",25),i.bc(36,"nz-option",26),i.bc(37,"nz-option",27),i.bc(38,"nz-option",28),i.fc(),i.fc(),i.fc(),i.fc(),i.fc(),i.fc(),i.fc(),i.gc(39,"nz-tab",3),i.Qc(40,Xe,2,0,"ng-template",null,29,i.Rc),i.bc(42,"endpoint-actions-list",30),i.fc(),i.Qc(43,Ze,7,4,"nz-tab",31),i.sc(44,"async"),i.fc(),i.fc(),i.dc()}if(2&e){var c=t.$implicit,r=i.Gc(5),o=i.Gc(41),l=i.rc();i.Mb(1),i.yc("formGroup",l.form),i.Mb(1),i.yc("nzAnimated",i.Ac(13,et)),i.Mb(1),i.yc("nzTitle",r),i.Mb(19),i.yc("nzBordered",!0),i.Mb(1),i.yc("nzActive",!0),i.Mb(2),i.yc("ngIf",!!l.form.value.Enabled),i.Mb(1),i.yc("ngIf",!l.form.value.Enabled),i.Mb(7),i.yc("nzTokenSeparators",i.Ac(14,tt)),i.Mb(6),i.yc("nzTitle",o),i.Mb(3),i.yc("ruleId",c.Id),i.Mb(1),i.yc("ngIf",i.tc(44,11,l.showDebugInformations$))}}var ct,rt,it,ot=[{path:"",component:ge},{path:":id",component:(ct=function(){function e(t,n,c,r){var i=this;_classCallCheck(this,e),this.uiService=t,this.route=n,this.rulesService=c,this.fb=r,this.rule$=Object(pe.a)(this.route.paramMap,this.route.queryParamMap,this.route.fragment).pipe(Object(me.a)((function(e){var t=_slicedToArray(e,3),n=t[0];return t[1],t[2],i.Id=n.get("id"),i.rulesService.GetRule(i.Id)})),Object(be.a)(),Object(a.a)((function(e){i.BaseRule||(i.BaseRule=e),i.rulesService.GetActionsForRule(e.Id).subscribe((function(e){return i.ruleActions=e})),i.uiService.Set((function(t){t.Header.Title="Endpoint Rule",t.Header.SubTitle=e.Name,t.Header.Icon="form",t.Footer.Button1.Visible=!0,t.Footer.Button2.Visible=!0})),i.form.patchValue(e)}))),this.showDebugInformations$=this.uiService.showDebugInformations$,this.selectedTab=new s.a(0),this.uiService.Set((function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button2.Disabled=!0,e.Footer.Button1.OnClick=function(){i.save()},e.Footer.Button2.Text="Reset",e.Footer.Button2.OnClick=function(){i.form.reset(i.BaseRule)},e.Footer.Show=!0})),this.form=this.fb.group({Id:[null],Name:[null,v.p.required],Scheme:[],Hostname:[],Path:[],HttpMethods:[[]],Order:[],Enabled:[!1]})}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedTab.subscribe((function(t){e.uiService.Set(0===t?function(e){e.Footer.Button1.Visible=!0,e.Footer.Button2.Visible=!0}:function(e){e.Footer.Button1.Visible=!1,e.Footer.Button2.Visible=!1})})),this.form.get("Name").valueChanges.subscribe((function(t){return e.uiService.Set((function(e){return e.Header.SubTitle=t}))})),this.form.valueChanges.subscribe((function(t){e.form.valid?e.SetButtonStatus(t):e.uiService.Set((function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="Form not valid!"}))}))}},{key:"GeneratePatchDocument",value:function(e,t){return t=null!=t?t:this.form.value,(e=null!=e?e:this.BaseRule).Actions=null,e.Permissions=null,t.Actions=null,t.Permissions=null,Object(ve.a)(e,t)}},{key:"save",value:function(){var e=this;this.rulesService.UpdatePartial(this.Id,this.GeneratePatchDocument()).pipe(Object(a.a)((function(){e.BaseRule=e.form.value,e.SetButtonStatus(e.BaseRule)}))).subscribe()}},{key:"SetButtonStatus",value:function(e){var t=this.GeneratePatchDocument(this.BaseRule,e);this.uiService.Set(t.length>0?function(e){e.Footer.Button1.Disabled=!1,e.Footer.Button1.Text="Save Changes",e.Footer.Button2.Disabled=!1}:function(e){e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="No Changes",e.Footer.Button2.Disabled=!0})}},{key:"tabChanged",value:function(e){var t;this.selectedTab.next(null!==(t=e.index)&&void 0!==t?t:0)}},{key:"isNotSelected",value:function(e){return-1===this.form.value.HttpMethods.indexOf(e)}},{key:"BaseRule",set:function(e){this._baseRule=JSON.parse(JSON.stringify(e))},get:function(){return this._baseRule}}]),e}(),ct.\u0275fac=function(e){return new(e||ct)(i.ac(o.a),i.ac(r.a),i.ac(h.a),i.ac(v.d))},ct.\u0275cmp=i.Ub({type:ct,selectors:[["endpoint-rule-details"]],decls:2,vars:3,consts:[[4,"ngIf"],["nz-form","",2,"flex-grow","1","display","flex","flex-direction","column","overflow","hidden",3,"formGroup"],[3,"nzAnimated","nzSelectChange"],[3,"nzTitle"],["BasicTitle",""],[2,"display","flex","flex-direction","row","padding","3px"],[2,"flex-grow","1"],["nzRequired","","nzFor","Name"],["nz-input","","formControlName","Name","id","Name",2,"width","100%"],["nzRequired","","nzFor","Path"],["nz-input","","formControlName","Path","id","Path",2,"width","100%"],["nzFor","Hostname"],["nz-input","","formControlName","Hostname","id","Hostname","placeHolder","*",2,"width","100%"],[2,"width","10px","margin-right","10px"],[2,"width","30%"],["nzAccordion","",3,"nzBordered"],["nzHeader","Options",3,"nzActive"],["nz-checkbox","","formControlName","Enabled"],["nzHeader","Schemes"],["nzMode","multiple","nzPlaceHolder","all Schemes allowed","formControlName","Scheme","nzMode","tags",2,"width","100%"],["nzLabel","Http","nzValue","http"],["nzLabel","Https","nzValue","https"],["nzHeader","Http Methods"],["nzMode","multiple","nzPlaceHolder","all Methods allowed","formControlName","HttpMethods","nzMode","tags",2,"width","100%",3,"nzTokenSeparators"],["nzLabel","Get","nzValue","Get"],["nzLabel","Post","nzValue","Post"],["nzLabel","Put","nzValue","Put"],["nzLabel","Delete","nzValue","Delete"],["nzLabel","Patch","nzValue","Patch"],["ActionsTitle",""],[3,"ruleId"],[3,"nzTitle",4,"ngIf"],["nz-icon","","nzType","container"],["nz-icon","","nzType","ordered-list"],["DebugTitle",""],[2,"height","100%"],["nz-icon","","nzType","bug"]],template:function(e,t){1&e&&(i.Qc(0,nt,45,15,"ng-container",0),i.sc(1,"async")),2&e&&i.yc("ngIf",i.tc(1,1,t.rule$))},directives:[c.t,v.q,v.m,w.b,v.g,ye.c,ye.a,_.a,w.d,w.a,z.b,v.c,v.l,v.f,Ce.a,Ce.c,H.a,j.b,j.a,qe,ze.b,x.a],pipes:[c.b,c.k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}"]}),ct)}],lt=((rt=function e(){_classCallCheck(this,e)}).\u0275mod=i.Yb({type:rt}),rt.\u0275inj=i.Xb({factory:function(e){return new(e||rt)},imports:[[r.l.forChild(ot)],r.l]}),rt),at=n("Hhmg"),st=n("DTEk"),ut=((it=function e(){_classCallCheck(this,e)}).\u0275mod=i.Yb({type:it}),it.\u0275inj=i.Xb({factory:function(e){return new(e||it)},imports:[[c.c,v.o,lt,d.d,at.a,st.a]]}),it)}}]);