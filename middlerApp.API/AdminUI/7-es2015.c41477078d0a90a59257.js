(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{oWrh:function(e,t,n){"use strict";n.r(t),n.d(t,"EndpointRulesModule",(function(){return Ye}));var c=n("ofXK"),i=n("tyNb"),o=n("fXoL"),r=n("ZF+8"),l=n("xr/A"),s=n("vkgz"),a=n("2Vo4");class d{constructor(e){this.Item=e,this._showDetails=!1,this.ShowDetailsSubject$=new a.a(!1),this.ShowDetails$=this.ShowDetailsSubject$.asObservable()}set ShowDetails(e){this._showDetails=e,this.ShowDetailsSubject$.next(this._showDetails)}get ShowDetails(){return this._showDetails}}var u=n("5+WD");class f{constructor(){this.AllItems=[],this.Selected=[]}get Single(){var e;return 1===(null===(e=this.Selected)||void 0===e?void 0:e.length)?this.Selected[0]:null}get IsFirst(){return this.Single?this.AllItems[0].Id===this.Single.Id:null}get IsLast(){return this.Single?this.AllItems[this.AllItems.length-1].Id===this.Single.Id:null}}var g=n("GH2U"),h=n("h0m+");class p{constructor(){this.Enabled=!1}}class m{constructor(){this.RewriteTo=""}}class b extends p{constructor(){super(...arguments),this.ActionType="UrlRewrite",this.Parameters=new m}}var v=n("3Pt+"),x=n("t7qs"),S=n("OzZK"),O=n("RwU8"),M=n("C2AL");function C(e,t){1&e&&(o.gc(0,"div"),o.Sc(1,"Action"),o.fc())}const I=["*"];let z=(()=>{class e{constructor(){this.ok=new o.q,this.cancel=new o.q}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Ub({type:e,selectors:[["action-basic-modal"]],hostAttrs:[1,"flex-grow-column"],inputs:{form:"form"},outputs:{ok:"ok",cancel:"cancel"},ngContentSelectors:I,decls:15,vars:2,consts:[[1,"modal-header",2,"padding","10px !important","display","flex"],[2,"font-size","2em","font-weight","bold","line-height","1.4285em","color","whitesmoke","margin","auto"],["dbPortal","ActionModalHeader-Left",1,"Irgendwos"],["left","dbPortal"],[4,"ngIf"],[2,"flex-grow","1"],["dbPortal","ActionModalHeader-Right"],[1,"modal-content",2,"padding-bottom","10px"],[1,"modal-footer",2,"margin-bottom","0px"],["nz-button","","nzType","primary","nzBlock","",2,"margin-right","1px",3,"disabled","click"],["nz-button","","nzType","default","nzBlock","",1,"secondary",2,"margin-left","1px",3,"click"]],template:function(e,t){if(1&e&&(o.xc(),o.gc(0,"div",0),o.gc(1,"div",1),o.cc(2,2,3),o.Qc(4,C,2,0,"div",4),o.fc(),o.bc(5,"div",5),o.gc(6,"div"),o.cc(7,6),o.fc(),o.fc(),o.gc(8,"div",7),o.wc(9),o.fc(),o.gc(10,"div",8),o.gc(11,"button",9),o.oc("click",(function(){return t.ok.next()})),o.Sc(12,"Save"),o.fc(),o.gc(13,"button",10),o.oc("click",(function(){return t.cancel.next()})),o.Sc(14,"Close"),o.fc(),o.fc()),2&e){const e=o.Gc(3);o.Mb(4),o.yc("ngIf",!e.hasSource),o.Mb(7),o.yc("disabled",!t.form.valid)}},directives:[x.d,c.t,S.a,O.a,M.a],styles:[".modal-header[_ngcontent-%COMP%]{background-color:#292f3b!important;border:1px solid #fff!important}.modal-header[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   .ui.huge.header[_ngcontent-%COMP%]{color:#fff!important}.modal-footer[_ngcontent-%COMP%]{padding:8px}.modal-content[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border:none!important;display:flex}.modal-content[_ngcontent-%COMP%]{flex-grow:1;padding:8px 8px 0}.flex-grow-column[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], action-basic-modal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ng-component[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}action-basic-modal[_ngcontent-%COMP%]   div[name][_ngcontent-%COMP%]{min-height:1.28571429em}action-basic-modal[_ngcontent-%COMP%]{box-shadow:3px 3px 5px 0 #333}"]}),e})();var w=n("ocnv"),y=n("B+r4"),k=n("PTRe");function P(e,t){1&e&&o.Sc(0," Url - Rewrite ")}let R=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RewriteTo:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(o.ac(v.d),o.ac(h.d))},e.\u0275cmp=o.Ub({type:e,selectors:[["ng-component"]],decls:7,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RewriteTo"],["nz-input","","formControlName","RewriteTo","id","RewriteTo",2,"width","100%"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(o.gc(0,"action-basic-modal",0),o.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),o.gc(1,"form",1),o.gc(2,"nz-form-label",2),o.Sc(3,"RewriteTo"),o.fc(),o.gc(4,"nz-form-control"),o.bc(5,"input",3),o.fc(),o.Qc(6,P,1,0,"ng-template",4),o.fc(),o.fc()),2&e&&(o.yc("form",t.form),o.Mb(1),o.yc("formGroup",t.form))},directives:[z,v.q,v.m,w.b,v.g,y.a,w.d,w.a,k.b,v.c,v.l,v.f,x.e],styles:[""]}),e})();class A{constructor(){this.RedirectTo="",this.Permanent=!1,this.PreserveMethod=!0}}class T extends p{constructor(){super(...arguments),this.ActionType="UrlRedirect",this.Parameters=new A}}var _=n("TaO5");function D(e,t){1&e&&o.Sc(0," Url - Redirect ")}let H=(()=>{class e{constructor(e,t){this.fb=e,this.context=t}ngOnInit(){this.form=this.fb.group({RedirectTo:[],Permanent:[],PreserveMethod:[]}),this.form.patchValue(this.context.data.Parameters)}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(o.ac(v.d),o.ac(h.d))},e.\u0275cmp=o.Ub({type:e,selectors:[["ng-component"]],decls:14,vars:2,consts:[[3,"form","ok","cancel"],["nz-form","",2,"width","100%",3,"formGroup"],["nzRequired","","nzFor","RedirectTo"],["nz-input","","formControlName","RedirectTo","id","RedirectTo",2,"width","100%"],[2,"display","flex","flex-direction","row"],[1,"field"],["nz-checkbox","","formControlName","PreserveMethod"],["nz-checkbox","","formControlName","Permanent"],["dbPortalTemplate","ActionModalHeader-Left"]],template:function(e,t){1&e&&(o.gc(0,"action-basic-modal",0),o.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),o.gc(1,"form",1),o.gc(2,"nz-form-label",2),o.Sc(3,"RedirectTo"),o.fc(),o.gc(4,"nz-form-control"),o.bc(5,"input",3),o.fc(),o.gc(6,"div",4),o.gc(7,"div",5),o.gc(8,"label",6),o.Sc(9,"PreserveMethod"),o.fc(),o.fc(),o.gc(10,"div",5),o.gc(11,"label",7),o.Sc(12,"Permanent"),o.fc(),o.fc(),o.fc(),o.Qc(13,D,1,0,"ng-template",8),o.fc(),o.fc()),2&e&&(o.yc("form",t.form),o.Mb(1),o.yc("formGroup",t.form))},directives:[z,v.q,v.m,w.b,v.g,y.a,w.d,w.a,k.b,v.c,v.l,v.f,_.a,x.e],styles:[".field[_ngcontent-%COMP%]{padding-top:5px}"]}),e})();class F{constructor(){this.Language="Typescript"}}class B extends p{constructor(){super(...arguments),this.ActionType="Script",this.Parameters=new F}}var L=n("jfkr"),U=n("zAKX");function G(e,t){1&e&&o.Sc(0," Script ")}function E(e,t){1&e&&(o.gc(0,"div",6),o.gc(1,"div",7),o.gc(2,"nz-select",8),o.bc(3,"nz-option",9),o.bc(4,"nz-option",10),o.bc(5,"nz-option",11),o.fc(),o.fc(),o.fc())}const Q=function(){return{noLib:!0}};let N=(()=>{class e{constructor(e,t,n){this.fb=e,this.context=t,this.rulesService=n,this.typings$=this.rulesService.typings$.pipe(Object(s.a)(e=>console.log(e)))}ngOnInit(){this.form=this.fb.group({Language:[],SourceCode:[]}),this.context.data.Parameters.Language||(this.context.data.Parameters.Language="Typescript"),this.form.patchValue(this.context.data.Parameters)}initRestrictionsAccordion(e){$(e.nativeElement).accordion()}ok(){this.context.invoke("OK",this.form.value)}cancel(){this.context.handle.Close()}}return e.\u0275fac=function(t){return new(t||e)(o.ac(v.d),o.ac(h.d),o.ac(g.a))},e.\u0275cmp=o.Ub({type:e,selectors:[["ng-component"]],decls:7,vars:8,consts:[[3,"form","ok","cancel"],["nz-form","",1,"flex-grow-column",2,"width","100%",3,"formGroup"],[1,"field","flex-grow-column"],["formControlName","SourceCode",3,"language","typings","tsOptions"],["dbPortalTemplate","ActionModalHeader-Left"],["dbPortalTemplate","ActionModalHeader-Right"],[1,"fields"],[2,"width","180px"],["formControlName","Language",2,"width","100%"],["nzLabel","Typescript","nzValue","Typescript"],["nzLabel","Javascript","nzValue","Javascript"],["nzLabel","Powershell","nzValue","Powershell"]],template:function(e,t){1&e&&(o.gc(0,"action-basic-modal",0),o.oc("ok",(function(){return t.ok()}))("cancel",(function(){return t.cancel()})),o.gc(1,"form",1),o.gc(2,"div",2),o.bc(3,"db-editor",3),o.sc(4,"async"),o.fc(),o.Qc(5,G,1,0,"ng-template",4),o.Qc(6,E,6,0,"ng-template",5),o.fc(),o.fc()),2&e&&(o.yc("form",t.form),o.Mb(1),o.yc("formGroup",t.form),o.Mb(2),o.yc("language",t.form.value.Language)("typings",o.tc(4,5,t.typings$))("tsOptions",o.Ac(7,Q)))},directives:[z,v.q,v.m,w.b,v.g,L.a,v.l,v.f,x.e,U.b,U.a],pipes:[c.b],styles:[""]}),e})(),j=(()=>{class e{constructor(e,t){this.modal=e,this.componentFactoryResolver=t}GetIcon(e){switch(e.ActionType){case"UrlRedirect":return"rollback";case"UrlRewrite":return"edit";case"Proxy":return"fa#random";case"Script":return"code"}return"hat wizard"}GetModal(e){switch(e.toLowerCase()){case"urlredirect":return this.modal.FromComponent(H).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"urlrewrite":return this.modal.FromComponent(R).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"50%",maxWidth:"500px"}}).CloseOnOutsideClick();case"script":return this.modal.FromComponent(N).SetModalOptions({componentFactoryResolver:this.componentFactoryResolver,overlayConfig:{width:"80%",height:"90%"}}).CloseOnOutsideClick()}}}return e.\u0275fac=function(t){return new(t||e)(o.kc(h.b),o.kc(o.k))},e.\u0275prov=o.Wb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var V=n("gPmL"),q=n("nJia"),K=n("Q8cG");const J=["contextMenu"],W=["addRuleTemplate"];function X(e,t){1&e&&(o.gc(0,"div",8),o.gc(1,"div",9),o.Sc(2,"Currently there is nothing..."),o.fc(),o.gc(3,"p"),o.Sc(4,"Use the ContextMenu to create your first rule!"),o.fc(),o.fc())}function Y(e,t){if(1&e&&(o.gc(0,"span",19),o.bc(1,"db-icon",20),o.fc()),2&e){const e=t.$implicit,n=o.rc(2);o.yc("nzTooltipTitle",e.ActionType),o.Mb(1),o.yc("icon",n.GetIcon(e))}}function Z(e,t){if(1&e){const e=o.hc();o.gc(0,"div",10),o.oc("click",(function(n){o.Ic(e);const c=t.$implicit;return o.rc().clickAction(n,c)}))("contextmenu",(function(n){o.Ic(e);const c=t.$implicit,i=o.rc(),r=o.Gc(11);return i.openItemContextMenu(n,r,c)}))("dblclick",(function(){o.Ic(e);const n=t.$implicit;return o.rc().editRule(n.Item.Id)})),o.gc(1,"div",11),o.gc(2,"div",12),o.bc(3,"db-icon",13),o.fc(),o.gc(4,"div",14),o.gc(5,"div",15),o.Sc(6),o.fc(),o.gc(7,"div"),o.Sc(8),o.fc(),o.fc(),o.gc(9,"div",16),o.gc(10,"div"),o.Sc(11),o.fc(),o.gc(12,"div"),o.Sc(13),o.fc(),o.fc(),o.gc(14,"div",17),o.gc(15,"div"),o.Sc(16),o.fc(),o.Qc(17,Y,2,2,"span",18),o.fc(),o.fc(),o.fc()}if(2&e){const e=t.$implicit;o.Sb("selected",e.Selected)("disabled",!e.Item.Enabled),o.Mb(6),o.Tc(e.Item.Name),o.Mb(2),o.Tc(e.Item.Path),o.Mb(3),o.Tc(e.Item.Scheme),o.Mb(2),o.Tc(e.Item.Hostname),o.Mb(3),o.Uc(" ",(null==e.Item.Actions?null:e.Item.Actions.length)||0," Actions "),o.Mb(1),o.yc("ngForOf",e.Item.Actions)}}function ee(e,t){if(1&e){const e=o.hc();o.gc(0,"ul",21),o.gc(1,"li",22),o.gc(2,"ul",23),o.gc(3,"li",24),o.oc("click",(function(){return o.Ic(e),o.rc().CreateRuleOnTop()})),o.bc(4,"db-icon",25),o.Sc(5," Top "),o.fc(),o.gc(6,"li",24),o.oc("click",(function(){return o.Ic(e),o.rc().CreateRuleOnBottom()})),o.bc(7,"db-icon",26),o.Sc(8," Bottom "),o.fc(),o.fc(),o.fc(),o.fc()}}function te(e,t){if(1&e){const e=o.hc();o.gc(0,"li",24),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().SetRuleEnabled(t.Single,!0)})),o.bc(1,"db-icon",31),o.Sc(2," Enable "),o.fc()}}function ne(e,t){if(1&e){const e=o.hc();o.gc(0,"li",24),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().SetRuleEnabled(t.Single,!1)})),o.bc(1,"db-icon",32),o.Sc(2," Disable "),o.fc()}}function ce(e,t){if(1&e){const e=o.hc();o.gc(0,"li",22),o.gc(1,"ul",23),o.gc(2,"li",24),o.oc("click",(function(){return o.Ic(e),o.rc(2).CreateRuleOnTop()})),o.bc(3,"db-icon",25),o.Sc(4," Top "),o.fc(),o.gc(5,"li",24),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateRuleBefore(t.Single)})),o.bc(6,"db-icon",33),o.Sc(7," Before "),o.fc(),o.gc(8,"li",24),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateRuleAfter(t.Single)})),o.bc(9,"db-icon",34),o.Sc(10," After "),o.fc(),o.gc(11,"li",24),o.oc("click",(function(){return o.Ic(e),o.rc(2).CreateRuleOnBottom()})),o.bc(12,"db-icon",26),o.Sc(13," Bottom "),o.fc(),o.fc(),o.fc()}}function ie(e,t){if(1&e){const e=o.hc();o.gc(0,"ul",21),o.Qc(1,te,3,0,"li",27),o.Qc(2,ne,3,0,"li",27),o.Qc(3,ce,14,0,"li",28),o.bc(4,"li",29),o.gc(5,"li",24),o.oc("click",(function(){o.Ic(e);const n=t.$implicit;return o.rc().RemoveRules(n.Selected)})),o.bc(6,"db-icon",30),o.Sc(7," Remove "),o.fc(),o.fc()}if(2&e){const e=t.$implicit;o.Mb(1),o.yc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),o.Mb(1),o.yc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),o.Mb(1),o.yc("ngIf",e.Single)}}const oe=function(){return[]};let re=(()=>{class e{constructor(e,t,n,c,i,r,l){this.rulesService=e,this.cref=t,this.overlay=n,this.viewContainerRef=c,this.router=i,this.route=r,this.actionHelper=l,this._rules=[],this.rulesSubject$=new a.a(this._rules),this.rules$=this.rulesSubject$.asObservable(),this.rulesChanged=new o.q,this.selected=[],this.registered=[],this.onTouched=()=>{}}set rules(e){this._rules=(e||[]).map(e=>{const t=this._rules.find(t=>t.Item.Id===e.Id);return t?(t.Item=e,t):new d(e)}),this.rulesSubject$.next(this._rules)}get rules(){return this._rules.map(e=>e.Item)}ngOnInit(){this.rulesService.MiddlerRules$.pipe(Object(s.a)(e=>{this.rules=e})).subscribe()}ngAfterViewInit(){}clickAction(e,t){e.ctrlKey?t.Selected=!t.Selected:this._rules=this._rules.map(e=>(e.Selected=e==t,e))}openOuterContextMenu(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}openItemContextMenu(e,t,n){var c;e.stopPropagation();const i=this._rules.filter(e=>e.Selected);0!=i.length&&i.includes(n)||(this._rules=this._rules.map(e=>(e.Selected=e==n,e))),null===(c=this.ContextMenu)||void 0===c||c.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}DeSelectAll(){console.log("Deselect"),this._rules=this._rules.map(e=>(e.Selected=!1,e))}SetRuleEnabled(e,t){this.rulesService.SetRuleEnabled(e,t)}GetActionByIndex(e){return this.rules[e]}GetActionById(e){return this.rules.find(t=>t.Id===e)}ClearSelection(){this.selected=[],this.cref.markForCheck()}BuildContext(){const e=new f;return e.AllItems=this.rules,e.Selected=this._rules.filter(e=>e.Selected).map(e=>e.Item),e}initContextMenu(e){}CreateRuleOnTop(){let e=new l.a;e.Enabled=!1,e.Order=this.rules&&0!=this.rules.length?this.rules[0].Order/2:10,this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}CreateRuleBefore(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new l.a;n.Enabled=!1,n.Order=0==t?e.Order/2:e.Order-(e.Order-this.rules[t-1].Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleAfter(e){const t=this.rules.findIndex(t=>t.Order===e.Order);let n=new l.a;n.Enabled=!1,n.Order=t==this.rules.length-1?this.rulesService.GetNextLastOrder():e.Order+(this.rules[t+1].Order-e.Order)/2,console.log(n),this.rulesService.Add(n).subscribe(),this.ContextMenu.Close()}CreateRuleOnBottom(){let e=new l.a;e.Enabled=!1,e.Order=this.rulesService.GetNextLastOrder(),this.rulesService.Add(e).subscribe(),this.ContextMenu.Close()}RemoveRules(e){e.forEach(e=>this.rulesService.Remove(e.Id).subscribe()),this.ContextMenu.Close()}SaveOrder(){this.rulesService.UpdateRulesOrder().subscribe()}editRule(e){this.router.navigate([e],{relativeTo:this.route})}calculateRuleOrder(e){if(0===this.rules.length)return 10;if(0===e)return this.rules[0].Order/2;if(e>=this.rules.length)return this.rulesService.GetNextLastOrder();const t=this.rules[e-1].Order;return(this.rules[e].Order-t)/2+t}drop(e){if(e.previousContainer===e.container){const t=this.rulesService.MiddlerRules[e.previousIndex];let n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),!n)return;if("forward"===n)if(e.currentIndex===this.rulesService.MiddlerRules.length-1)t.Order=this.rulesService.GetNextLastOrder();else{const n=this.rulesService.MiddlerRules[e.currentIndex];t.Order=(this.rulesService.MiddlerRules[e.currentIndex+1].Order-n.Order)/2+n.Order}else if("back"===n)if(0===e.currentIndex)t.Order=this.rulesService.MiddlerRules[0].Order/2;else{const n=this.rulesService.MiddlerRules[e.currentIndex-1];t.Order=(this.rulesService.MiddlerRules[e.currentIndex].Order-n.Order)/2+n.Order}Object(u.e)(this.rulesService.MiddlerRules,e.previousIndex,e.currentIndex),this.rulesService.MiddlerRules=[...this.rulesService.MiddlerRules],this.SaveOrder()}else{let t=new l.a;t.Enabled=!1,console.log(e),t.Order=this.calculateRuleOrder(e.currentIndex),this.rulesService.Add(t).subscribe()}}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}propagateChange(e){this.rulesChanged.next(e),this.registered.forEach(t=>{t(e)})}writeValue(e){this.rules=e}registerOnChange(e){-1===this.registered.indexOf(e)&&this.registered.push(e)}registerOnTouched(e){this.onTouched=e}setDisabledState(e){throw new Error("Method not implemented.")}}return e.\u0275fac=function(t){return new(t||e)(o.ac(g.a),o.ac(o.h),o.ac(h.c),o.ac(o.Y),o.ac(i.i),o.ac(i.a),o.ac(j))},e.\u0275cmp=o.Ub({type:e,selectors:[["enpoint-rules-list"]],viewQuery:function(e,t){var n;1&e&&(o.Xc(J,!0),o.Xc(W,!0)),2&e&&(o.Fc(n=o.pc())&&(t.contextMenu=n.first),o.Fc(n=o.pc())&&(t.addRuleTemplate=n.first))},inputs:{rules:"rules"},outputs:{rulesChanged:"rulesChanged"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",1,"",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","rule-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","contextmenu","dblclick",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"rule-item",3,"click","contextmenu","dblclick"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["icon","fa#ellipsis-v",2,"width","1.18em","margin","0 .25rem 0 0","font-size","1.2em"],[2,"padding","5px","min-width","50%","max-width","50%"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[2,"padding","5px","min-width","200px","max-width","200px"],[2,"padding","5px"],["nz-tooltip","",3,"nzTooltipTitle",4,"ngFor","ngForOf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"icon"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["icon","double-left","rotate","90"],["icon","double-right","rotate","90"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Rule","nzIcon","menu-unfold",4,"ngIf"],["nz-menu-divider",""],["icon","delete"],["icon","fa#toggle-on"],["icon","fa#toggle-off"],["icon","up"],["icon","down"]],template:function(e,t){if(1&e){const e=o.hc();o.gc(0,"div",0,1),o.oc("contextmenu",(function(n){o.Ic(e);const c=o.Gc(9);return t.openOuterContextMenu(n,c)})),o.gc(2,"div",2,3),o.oc("cdkDropListDropped",(function(e){return t.drop(e)})),o.Qc(4,X,5,0,"div",4),o.sc(5,"async"),o.Qc(6,Z,18,10,"div",5),o.sc(7,"async"),o.fc(),o.fc(),o.Qc(8,ee,9,0,"ng-template",null,6,o.Rc),o.Qc(10,ie,8,3,"ng-template",null,7,o.Rc)}2&e&&(o.Mb(4),o.yc("ngIf",0===(o.tc(5,2,t.rules$)||o.Ac(6,oe)).length),o.Mb(2),o.yc("ngForOf",o.tc(7,4,t.rules$)))},directives:[u.c,c.t,c.s,u.a,u.b,V.c,q.b,K.c,M.a,K.g,K.e,K.d],pipes:[c.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.rule-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.rule-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.rule-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.rule-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.rule-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.rule-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}.anticon.disabled[_ngcontent-%COMP%]{color:#ccc}"],changeDetection:0}),e})(),le=(()=>{class e{constructor(e){this.uiService=e,e.Set(e=>{e.Header.Title="Endpoint Rules",e.Content.Scrollable=!1,e.Header.Icon="fa#stream"})}}return e.\u0275fac=function(t){return new(t||e)(o.ac(r.a))},e.\u0275cmp=o.Ub({type:e,selectors:[["ng-component"]],decls:2,vars:0,consts:[[2,"display","flex","flex-direction","column","flex-grow","1"]],template:function(e,t){1&e&&(o.gc(0,"div",0),o.bc(1,"enpoint-rules-list"),o.fc())},directives:[re],styles:[""]}),e})();var se=n("itXk"),ae=n("lJxs"),de=n("bHdf"),ue=n("1zMv"),fe=n("oyxB"),ge=n("IvDN");const he=["urlredirect"],pe=["urlrewrite"],me=["script"];function be(e,t){if(1&e&&(o.gc(0,"div"),o.Sc(1),o.fc(),o.gc(2,"div"),o.Sc(3),o.fc(),o.gc(4,"div"),o.Sc(5),o.fc()),2&e){const e=o.rc();o.Mb(1),o.Uc(" Redirect to ",e.action.Parameters.RedirectTo," "),o.Mb(2),o.Uc(" Permanent: ",e.action.Parameters.Permanent," "),o.Mb(2),o.Uc(" PreserveMethod: ",e.action.Parameters.PreserveMethod," ")}}function ve(e,t){if(1&e&&(o.gc(0,"div"),o.Sc(1),o.fc()),2&e){const e=o.rc();o.Mb(1),o.Uc(" Rewrite to ",e.action.Parameters.RewriteTo," ")}}function xe(e,t){if(1&e&&(o.gc(0,"div"),o.Sc(1),o.fc()),2&e){const e=o.rc();o.Mb(1),o.Uc(" ",e.action.Parameters.Language," ")}}let Se=(()=>{class e{ngOnInit(){this.template=this.determineTemplate()}determineTemplate(){switch(this.action.ActionType){case"UrlRedirect":return this.UrlRedirect;case"UrlRewrite":return this.UrlRewrite;case"Script":return this.Script}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Ub({type:e,selectors:[["action-list-details"]],viewQuery:function(e,t){var n;1&e&&(o.Oc(he,!0),o.Oc(pe,!0),o.Oc(me,!0)),2&e&&(o.Fc(n=o.pc())&&(t.UrlRedirect=n.first),o.Fc(n=o.pc())&&(t.UrlRewrite=n.first),o.Fc(n=o.pc())&&(t.Script=n.first))},inputs:{action:"action"},decls:8,vars:1,consts:[[2,"font-size","x-small"],[3,"ngTemplateOutlet"],["urlredirect",""],["urlrewrite",""],["script",""]],template:function(e,t){1&e&&(o.gc(0,"div",0),o.cc(1,1),o.fc(),o.Qc(2,be,6,3,"ng-template",null,2,o.Rc),o.Qc(4,ve,2,1,"ng-template",null,3,o.Rc),o.Qc(6,xe,2,1,"ng-template",null,4,o.Rc)),2&e&&(o.Mb(1),o.yc("ngTemplateOutlet",t.template))},directives:[c.A],styles:[""]}),e})();var Oe=n("FwiY"),Me=n("6NWb");function Ce(e,t){1&e&&(o.gc(0,"div",8),o.gc(1,"div",9),o.Sc(2,"Currently there is nothing..."),o.fc(),o.gc(3,"p"),o.Sc(4,"Use the ContextMenu to create your first action!"),o.fc(),o.fc())}function Ie(e,t){if(1&e&&o.bc(0,"i",20),2&e){const e=o.rc().$implicit;o.yc("nzType",e.icon)}}function ze(e,t){if(1&e&&o.bc(0,"fa-icon",21),2&e){const e=o.rc().$implicit;o.yc("icon",e.icon)}}function we(e,t){if(1&e&&(o.gc(0,"div",17),o.Qc(1,Ie,1,1,"i",18),o.Qc(2,ze,1,1,"fa-icon",19),o.fc()),2&e){const e=t.$implicit;o.Mb(1),o.yc("ngIf","ant"==e.type),o.Mb(1),o.yc("ngIf","fa"==e.type)}}function ye(e,t){if(1&e){const e=o.hc();o.gc(0,"div",10),o.oc("click",(function(n){o.Ic(e);const c=t.$implicit;return o.rc().ClickAction(n,c)}))("dblclick",(function(){o.Ic(e);const n=t.$implicit;return o.rc().openModal(n)}))("contextmenu",(function(n){o.Ic(e);const c=t.$implicit,i=o.rc(),r=o.Gc(11);return i.openItemContextMenu(n,r,c)})),o.gc(1,"div",11),o.gc(2,"div",12),o.Qc(3,we,3,2,"div",13),o.fc(),o.gc(4,"div",14),o.gc(5,"div",15),o.Sc(6),o.fc(),o.bc(7,"action-list-details",16),o.fc(),o.fc(),o.fc()}if(2&e){const e=t.$implicit,n=o.rc();o.Sb("selected",n.IsActionSelected(e))("disabled",!e.Enabled),o.Mb(3),o.yc("ngIf",n.prepareIcon(n.GetIcon(e))),o.Mb(3),o.Tc(e.ActionType),o.Mb(1),o.yc("action",e)}}function ke(e,t){if(1&e){const e=o.hc();o.gc(0,"ul",22),o.gc(1,"li",23),o.gc(2,"ul",24),o.gc(3,"li",25),o.oc("click",(function(){return o.Ic(e),o.rc().CreateAction("UrlRedirect","bottom")})),o.bc(4,"i",26),o.Sc(5," UrlRedirect "),o.fc(),o.gc(6,"li",25),o.oc("click",(function(){return o.Ic(e),o.rc().CreateAction("UrlRewrite","bottom")})),o.bc(7,"i",27),o.Sc(8," UrlRewrite "),o.fc(),o.gc(9,"li",25),o.oc("click",(function(){return o.Ic(e),o.rc().CreateAction("Script","bottom")})),o.bc(10,"i",28),o.Sc(11," Script "),o.fc(),o.fc(),o.fc(),o.fc()}}const Pe=function(){return["fas","toggle-on"]};function Re(e,t){if(1&e){const e=o.hc();o.gc(0,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().SetActionEnabled(t.Single,!0)})),o.bc(1,"fa-icon",34),o.Sc(2," Enable "),o.fc()}2&e&&(o.Mb(1),o.yc("icon",o.Ac(1,Pe)))}const Ae=function(){return["fas","toggle-off"]};function Te(e,t){if(1&e){const e=o.hc();o.gc(0,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().SetActionEnabled(t.Single,!1)})),o.bc(1,"fa-icon",34),o.Sc(2," Disable "),o.fc()}2&e&&(o.Mb(1),o.yc("icon",o.Ac(1,Ae)))}function _e(e,t){if(1&e){const e=o.hc();o.gc(0,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().openModal(t.Single)})),o.bc(1,"i",35),o.Sc(2," Edit "),o.fc()}}function De(e,t){if(1&e){const e=o.hc();o.gc(0,"li",36),o.gc(1,"ul",24),o.gc(2,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("UrlRedirect","before",t.Single)})),o.bc(3,"i",26),o.Sc(4," UrlRedirect "),o.fc(),o.gc(5,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("UrlRewrite","before",t.Single)})),o.bc(6,"i",27),o.Sc(7," UrlRewrite "),o.fc(),o.gc(8,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("Script","before",t.Single)})),o.bc(9,"i",28),o.Sc(10," Script "),o.fc(),o.fc(),o.fc()}}function He(e,t){if(1&e){const e=o.hc();o.gc(0,"li",37),o.gc(1,"ul",24),o.gc(2,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("UrlRedirect","after",t.Single)})),o.bc(3,"i",26),o.Sc(4," UrlRedirect "),o.fc(),o.gc(5,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("UrlRewrite","after",t.Single)})),o.bc(6,"i",27),o.Sc(7," UrlRewrite "),o.fc(),o.gc(8,"li",25),o.oc("click",(function(){o.Ic(e);const t=o.rc().$implicit;return o.rc().CreateAction("Script","after",t.Single)})),o.bc(9,"i",28),o.Sc(10," Script "),o.fc(),o.fc(),o.fc()}}function Fe(e,t){if(1&e){const e=o.hc();o.gc(0,"ul",22),o.Qc(1,Re,3,2,"li",29),o.Qc(2,Te,3,2,"li",29),o.Qc(3,_e,3,0,"li",29),o.Qc(4,De,11,0,"li",30),o.Qc(5,He,11,0,"li",31),o.bc(6,"li",32),o.gc(7,"li",25),o.oc("click",(function(){o.Ic(e);const n=t.$implicit;return o.rc().RemoveActions(n.Selected)})),o.bc(8,"i",33),o.Sc(9," Remove "),o.fc(),o.fc()}if(2&e){const e=t.$implicit;o.Mb(1),o.yc("ngIf",!1===(null==e.Single?null:e.Single.Enabled)),o.Mb(1),o.yc("ngIf",!0===(null==e.Single?null:e.Single.Enabled)),o.Mb(1),o.yc("ngIf",e.Single),o.Mb(1),o.yc("ngIf",e.Single),o.Mb(1),o.yc("ngIf",e.Single)}}const $e=function(){return[]};let Be=(()=>{class e{constructor(e,t,n,c,i,o,r,l){this.uiService=e,this.modal=t,this.overlay=n,this.viewContainerRef=c,this.cref=i,this.componentFactoryResolver=o,this.actionHelper=r,this.rulesService=l,this.actionsSubject$=new a.a(null),this.actions$=this.actionsSubject$.asObservable(),this.selectedActions=[]}get actions(){return this.actionsSubject$.value}set actions(e){e=null==e?void 0:e.sort((e,t)=>e.Order>t.Order?1:e.Order<t.Order?-1:0),this.actionsSubject$.next(e)}ngOnInit(){this.rulesService.GetActionsForRule(this.ruleId).subscribe(e=>{this.actions=e})}IsActionSelected(e){return this.selectedActions.includes(e.Id)}setActionSelected(e,t){this.selectedActions=t?[...new Set([...this.selectedActions,e.Id])]:this.selectedActions.filter(t=>t!=e.Id)}GetSelectedActions(){return this.actions.filter(e=>this.selectedActions.includes(e.Id))}ClickAction(e,t){if(e.ctrlKey){const e=this.IsActionSelected(t);this.setActionSelected(t,!e)}else this.selectedActions=[],this.setActionSelected(t,!0)}OpenOuterContextMenu(e,t){var n;e.stopPropagation(),null===(n=this.ContextMenu)||void 0===n||n.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,null)}openItemContextMenu(e,t,n){var c;e.stopPropagation(),0!=this.selectedActions.length&&this.IsActionSelected(n)||this.setActionSelected(n,!0),null===(c=this.ContextMenu)||void 0===c||c.Close(),this.ContextMenu=this.overlay.OpenContextMenu(e,t,this.viewContainerRef,this.BuildContext())}BuildContext(){const e=new f;return e.AllItems=this.actions,e.Selected=this.actions.filter(e=>this.selectedActions.includes(e.Id)),e}GetIcon(e){return this.actionHelper.GetIcon(e)}prepareIcon(e){if(!e)return null;if(e.startsWith("fa#")){let t={type:"fa",icon:null};return e=e.substring(3),t.icon=e.includes("|")?e.split("|"):e,t}return{type:"ant",icon:e}}CreateAction(e,t,n){let c=new p;switch(e.toLowerCase()){case"urlredirect":c=new T;break;case"urlrewrite":c=new b;break;case"script":c=new B}c.Order=this.CalculateOrder(t,n),this.rulesService.AddAction(this.ruleId,c).subscribe()}GetLastNextOrder(){return this.actions&&0!==this.actions.length?Math.trunc(Math.max(...this.actions.map(e=>e.Order))+10):10}CalculateOrder(e,t){var n;const c=null===(n=this.actions)||void 0===n?void 0:n.findIndex(e=>e.Order===t.Order);switch(e){case"top":return this.actions&&0!=this.actions.length?this.actions[0].Order/2:10;case"before":return 0==c?t.Order/2:t.Order-(t.Order-this.actions[c-1].Order)/2;case"after":return c==this.actions.length-1?this.GetLastNextOrder():t.Order+(this.actions[c+1].Order-t.Order)/2;case"bottom":return this.GetLastNextOrder()}}SetActionEnabled(e,t){this.rulesService.SetActionEnabled(this.ruleId,e,t).subscribe(n=>{this.actions=this.actions.map(n=>(n==e&&(n.Enabled=t),n))})}RemoveActions(e){var t;const n=e.map(e=>e.Id);this.rulesService.RemoveActions(this.ruleId,...n).subscribe(e=>{this.actions=this.actions.filter(e=>!n.includes(e.Id))}),null===(t=this.ContextMenu)||void 0===t||t.Close()}drop(e){const t=this.actions[e.previousIndex];let n=null;if(e.previousIndex<e.currentIndex?n="forward":e.previousIndex>e.currentIndex&&(n="back"),n){if("forward"===n)if(e.currentIndex===this.actions.length-1)t.Order=this.rulesService.GetNextLastOrder();else{const n=this.actions[e.currentIndex];t.Order=(this.actions[e.currentIndex+1].Order-n.Order)/2+n.Order}else if("back"===n)if(0===e.currentIndex)t.Order=this.actions[0].Order/2;else{const n=this.actions[e.currentIndex-1];t.Order=(this.actions[e.currentIndex].Order-n.Order)/2+n.Order}Object(u.e)(this.actions,e.previousIndex,e.currentIndex),this.actions=[...this.actions],this.rulesService.UpdateActionsOrder(this.ruleId,this.actions).subscribe()}}generatePatchDocument(e,t){return Object(ue.a)(e,t)}openModal(e){var t;null===(t=this.ContextMenu)||void 0===t||t.Close();const n=Object.assign({},e);switch(e.ActionType){case"UrlRedirect":this.actionHelper.GetModal("UrlRedirect").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload;const c=this.generatePatchDocument(n,e);this.rulesService.PatchAction(this.ruleId,n.Id,c).subscribe(e=>{this.actions=[...this.actions]})}).Open();break;case"UrlRewrite":this.actionHelper.GetModal("UrlRewrite").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload;const c=this.generatePatchDocument(n,e);this.rulesService.PatchAction(this.ruleId,n.Id,c).subscribe(e=>{this.actions=[...this.actions]})}).Open();break;case"Script":this.actionHelper.GetModal("Script").SetData(e).AddEventHandler("OK",t=>{e.Parameters=t.payload;const c=this.generatePatchDocument(n,e);this.rulesService.PatchAction(this.ruleId,n.Id,c).subscribe(e=>{this.actions=[...this.actions]})}).Open()}}}return e.\u0275fac=function(t){return new(t||e)(o.ac(r.a),o.ac(h.b),o.ac(h.c),o.ac(o.Y),o.ac(o.h),o.ac(o.k),o.ac(j),o.ac(g.a))},e.\u0275cmp=o.Ub({type:e,selectors:[["endpoint-actions-list"]],inputs:{ruleId:"ruleId"},decls:12,vars:7,consts:[["cdkDropList","",1,"outer",2,"flex-grow","1","height","100%",3,"contextmenu"],["nullList","cdkDropList"],["cdkDropList","",2,"padding","2px","margin-top","8px","max-height","calc(100% - 30px)","overflow-y","auto",3,"cdkDropListDropped"],["rulesList","cdkDropList"],["style","text-align: center; font-size: 1.3em; font-weight: bold; color: #525e7678; line-height: 1.4em; line-height: 2em; margin: 0px 10px;",4,"ngIf"],["class","action-item","cdkDrag","","cdkDragLockAxis","y",3,"selected","disabled","click","dblclick","contextmenu",4,"ngFor","ngForOf"],["outerContextMenu",""],["itemContextMenu",""],[2,"text-align","center","font-size","1.3em","font-weight","bold","color","#525e7678","line-height","1.4em","line-height","2em","margin","0px 10px"],[2,"font-size","1.5em"],["cdkDrag","","cdkDragLockAxis","y",1,"action-item",3,"click","dblclick","contextmenu"],[2,"display","flex"],["cdkDragHandle","",1,"dragHandle",2,"padding","10px 0px 0px 5px"],["class","title-icon",4,"ngIf"],[2,"padding","5px","min-width","50%","max-width","50%"],[2,"font-size","large","font-weight","bold","color","#292f3b"],[3,"action"],[1,"title-icon"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","","nzTheme","outline",3,"nzType",4,"ngIf"],["style","font-size: xx-large; width: 40px; text-align: left;","nz-icon","",3,"icon",4,"ngIf"],["nz-icon","","nzTheme","outline",2,"font-size","xx-large","width","40px","text-align","left",3,"nzType"],["nz-icon","",2,"font-size","xx-large","width","40px","text-align","left",3,"icon"],["nz-menu","","nzMode","vertical",1,"context-menu"],["nz-submenu","","nzTitle","Add Action","nzIcon","menu-unfold"],[1,"context-menu"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","rollback","nzTheme","outline"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-icon","","nzType","code","nzTheme","outline"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up",4,"ngIf"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down",4,"ngIf"],["nz-menu-divider",""],["nz-icon","","nzType","delete","nzTheme","outline"],["nz-icon","",3,"icon"],["nz-icon","","nzType","form","nzTheme","outline"],["nz-submenu","","nzTitle","Add Action Before","nzIcon","up"],["nz-submenu","","nzTitle","Add Action After","nzIcon","down"]],template:function(e,t){if(1&e){const e=o.hc();o.gc(0,"div",0,1),o.oc("contextmenu",(function(n){o.Ic(e);const c=o.Gc(9);return t.OpenOuterContextMenu(n,c)})),o.gc(2,"div",2,3),o.oc("cdkDropListDropped",(function(e){return t.drop(e)})),o.Qc(4,Ce,5,0,"div",4),o.sc(5,"async"),o.Qc(6,ye,8,7,"div",5),o.sc(7,"async"),o.fc(),o.fc(),o.Qc(8,ke,12,0,"ng-template",null,6,o.Rc),o.Qc(10,Fe,10,5,"ng-template",null,7,o.Rc)}2&e&&(o.Mb(4),o.yc("ngIf",0===(o.tc(5,2,t.actions$)||o.Ac(6,$e)).length),o.Mb(2),o.yc("ngForOf",o.tc(7,4,t.actions$)))},directives:[u.c,c.t,c.s,u.a,u.b,Se,Oe.b,M.a,Me.b,K.c,K.g,K.e,K.d],pipes:[c.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.action-item[_ngcontent-%COMP%]{margin-bottom:10px!important;border-radius:0!important;box-shadow:0 0 3px 1px #cecece;background-color:#fff}.action-item.disabled[_ngcontent-%COMP%]{opacity:.6;box-shadow:none;background-color:#e2e2e2}.action-item[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{border-right:1px solid #fff}.action-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#525e76;color:#fff}.action-item.selected[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{background-color:#292f3b;color:#fff}.action-item[_ngcontent-%COMP%]:hover{background-color:#b2b7c2}.new-rule.ui.button[_ngcontent-%COMP%]{margin:0}.options[_ngcontent-%COMP%]{background-color:grey;height:50px}.list-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:inherit!important}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:inherit}.dragHandle[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.list-item[_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:#e0e1e2}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragHandle[_ngcontent-%COMP%]{cursor:inherit}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   .dragHandle[_ngcontent-%COMP%]{background-color:inherit}.list-item.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%], .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{border-radius:0!important;background-color:#2f2f2f;color:#f5f5f5}.outer.cdk-drop-list-dragging[_ngcontent-%COMP%] > .new-rule.cdk-drag.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.context-menu[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:0!important}"],changeDetection:0}),e})();function Le(e,t){1&e&&(o.bc(0,"i",32),o.Sc(1,"Basic "))}function Ue(e,t){1&e&&(o.gc(0,"span"),o.Sc(1,"Enabled"),o.fc())}function Ge(e,t){1&e&&(o.gc(0,"span"),o.Sc(1,"Disabled"),o.fc())}function Ee(e,t){1&e&&(o.bc(0,"i",33),o.Sc(1,"Actions"))}function Qe(e,t){1&e&&(o.bc(0,"i",36),o.Sc(1,"Debug"))}function Ne(e,t){if(1&e&&(o.gc(0,"nz-tab",3),o.Qc(1,Qe,2,0,"ng-template",null,34,o.Rc),o.gc(3,"div",35),o.gc(4,"pre"),o.Sc(5),o.sc(6,"json"),o.fc(),o.fc(),o.fc()),2&e){const e=o.Gc(2),t=o.rc(2);o.yc("nzTitle",e),o.Mb(5),o.Tc(o.tc(6,2,t.form.value))}}const je=function(){return{inkBar:!0,tabPane:!1}},Ve=function(){return[","]};function qe(e,t){if(1&e){const e=o.hc();o.ec(0),o.gc(1,"form",1),o.gc(2,"nz-tabset",2),o.oc("nzSelectChange",(function(t){return o.Ic(e),o.rc().tabChanged(t)})),o.gc(3,"nz-tab",3),o.Qc(4,Le,2,0,"ng-template",null,4,o.Rc),o.gc(6,"div",5),o.gc(7,"div",6),o.gc(8,"nz-form-label",7),o.Sc(9,"Name"),o.fc(),o.gc(10,"nz-form-control"),o.bc(11,"input",8),o.fc(),o.gc(12,"nz-form-label",9),o.Sc(13,"Path"),o.fc(),o.gc(14,"nz-form-control"),o.bc(15,"input",10),o.fc(),o.gc(16,"nz-form-label",11),o.Sc(17,"Hostname"),o.fc(),o.gc(18,"nz-form-control"),o.bc(19,"input",12),o.fc(),o.fc(),o.bc(20,"div",13),o.gc(21,"div",14),o.gc(22,"nz-collapse",15),o.gc(23,"nz-collapse-panel",16),o.gc(24,"label",17),o.Qc(25,Ue,2,0,"span",0),o.Qc(26,Ge,2,0,"span",0),o.fc(),o.fc(),o.gc(27,"nz-collapse-panel",18),o.gc(28,"nz-select",19),o.bc(29,"nz-option",20),o.bc(30,"nz-option",21),o.fc(),o.fc(),o.gc(31,"nz-collapse-panel",22),o.gc(32,"nz-form-control"),o.gc(33,"nz-select",23),o.bc(34,"nz-option",24),o.bc(35,"nz-option",25),o.bc(36,"nz-option",26),o.bc(37,"nz-option",27),o.bc(38,"nz-option",28),o.fc(),o.fc(),o.fc(),o.fc(),o.fc(),o.fc(),o.fc(),o.gc(39,"nz-tab",3),o.Qc(40,Ee,2,0,"ng-template",null,29,o.Rc),o.bc(42,"endpoint-actions-list",30),o.fc(),o.Qc(43,Ne,7,4,"nz-tab",31),o.sc(44,"async"),o.fc(),o.fc(),o.dc()}if(2&e){const e=t.$implicit,n=o.Gc(5),c=o.Gc(41),i=o.rc();o.Mb(1),o.yc("formGroup",i.form),o.Mb(1),o.yc("nzAnimated",o.Ac(13,je)),o.Mb(1),o.yc("nzTitle",n),o.Mb(19),o.yc("nzBordered",!0),o.Mb(1),o.yc("nzActive",!0),o.Mb(2),o.yc("ngIf",!!i.form.value.Enabled),o.Mb(1),o.yc("ngIf",!i.form.value.Enabled),o.Mb(7),o.yc("nzTokenSeparators",o.Ac(14,Ve)),o.Mb(6),o.yc("nzTitle",c),o.Mb(3),o.yc("ruleId",e.Id),o.Mb(1),o.yc("ngIf",o.tc(44,11,i.showDebugInformations$))}}const Ke=[{path:"",component:le},{path:":id",component:(()=>{class e{constructor(e,t,n,c){this.uiService=e,this.route=t,this.rulesService=n,this.fb=c,this.rule$=Object(se.a)(this.route.paramMap,this.route.queryParamMap,this.route.fragment).pipe(Object(ae.a)(([e,t,n])=>(this.Id=e.get("id"),this.rulesService.GetRule(this.Id))),Object(de.a)(),Object(s.a)(e=>{this.BaseRule||(this.BaseRule=e),this.rulesService.GetActionsForRule(e.Id).subscribe(e=>this.ruleActions=e),this.uiService.Set(t=>{t.Header.Title="Endpoint Rule",t.Header.SubTitle=e.Name,t.Header.Icon="form",t.Footer.Button1.Visible=!0,t.Footer.Button2.Visible=!0}),this.form.patchValue(e)})),this.showDebugInformations$=this.uiService.showDebugInformations$,this.selectedTab=new a.a(0),this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button2.Disabled=!0,e.Footer.Button1.OnClick=()=>{this.save()},e.Footer.Button2.Text="Reset",e.Footer.Button2.OnClick=()=>{this.form.reset(this.BaseRule)},e.Footer.Show=!0}),this.form=this.fb.group({Id:[null],Name:[null,v.p.required],Scheme:[],Hostname:[],Path:[],HttpMethods:[[]],Order:[],Enabled:[!1]})}ngOnInit(){this.selectedTab.subscribe(e=>{this.uiService.Set(0===e?e=>{e.Footer.Button1.Visible=!0,e.Footer.Button2.Visible=!0}:e=>{e.Footer.Button1.Visible=!1,e.Footer.Button2.Visible=!1})}),this.form.get("Name").valueChanges.subscribe(e=>this.uiService.Set(t=>t.Header.SubTitle=e)),this.form.valueChanges.subscribe(e=>{this.form.valid?this.SetButtonStatus(e):this.uiService.Set(e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="Form not valid!"})})}GeneratePatchDocument(e,t){return t=null!=t?t:this.form.value,(e=null!=e?e:this.BaseRule).Actions=null,e.Permissions=null,t.Actions=null,t.Permissions=null,Object(ue.a)(e,t)}save(){this.rulesService.UpdatePartial(this.Id,this.GeneratePatchDocument()).pipe(Object(s.a)(()=>{this.BaseRule=this.form.value,this.SetButtonStatus(this.BaseRule)})).subscribe()}SetButtonStatus(e){var t=this.GeneratePatchDocument(this.BaseRule,e);this.uiService.Set(t.length>0?e=>{e.Footer.Button1.Disabled=!1,e.Footer.Button1.Text="Save Changes",e.Footer.Button2.Disabled=!1}:e=>{e.Footer.Button1.Disabled=!0,e.Footer.Button1.Text="No Changes",e.Footer.Button2.Disabled=!0})}tabChanged(e){var t;this.selectedTab.next(null!==(t=e.index)&&void 0!==t?t:0)}isNotSelected(e){return-1===this.form.value.HttpMethods.indexOf(e)}set BaseRule(e){this._baseRule=JSON.parse(JSON.stringify(e))}get BaseRule(){return this._baseRule}}return e.\u0275fac=function(t){return new(t||e)(o.ac(r.a),o.ac(i.a),o.ac(g.a),o.ac(v.d))},e.\u0275cmp=o.Ub({type:e,selectors:[["endpoint-rule-details"]],decls:2,vars:3,consts:[[4,"ngIf"],["nz-form","",2,"flex-grow","1","display","flex","flex-direction","column","overflow","hidden",3,"formGroup"],[3,"nzAnimated","nzSelectChange"],[3,"nzTitle"],["BasicTitle",""],[2,"display","flex","flex-direction","row","padding","3px"],[2,"flex-grow","1"],["nzRequired","","nzFor","Name"],["nz-input","","formControlName","Name","id","Name",2,"width","100%"],["nzRequired","","nzFor","Path"],["nz-input","","formControlName","Path","id","Path",2,"width","100%"],["nzFor","Hostname"],["nz-input","","formControlName","Hostname","id","Hostname","placeHolder","*",2,"width","100%"],[2,"width","10px","margin-right","10px"],[2,"width","30%"],["nzAccordion","",3,"nzBordered"],["nzHeader","Options",3,"nzActive"],["nz-checkbox","","formControlName","Enabled"],["nzHeader","Schemes"],["nzMode","multiple","nzPlaceHolder","all Schemes allowed","formControlName","Scheme","nzMode","tags",2,"width","100%"],["nzLabel","Http","nzValue","http"],["nzLabel","Https","nzValue","https"],["nzHeader","Http Methods"],["nzMode","multiple","nzPlaceHolder","all Methods allowed","formControlName","HttpMethods","nzMode","tags",2,"width","100%",3,"nzTokenSeparators"],["nzLabel","Get","nzValue","Get"],["nzLabel","Post","nzValue","Post"],["nzLabel","Put","nzValue","Put"],["nzLabel","Delete","nzValue","Delete"],["nzLabel","Patch","nzValue","Patch"],["ActionsTitle",""],[3,"ruleId"],[3,"nzTitle",4,"ngIf"],["nz-icon","","nzType","container"],["nz-icon","","nzType","ordered-list"],["DebugTitle",""],[2,"height","100%"],["nz-icon","","nzType","bug"]],template:function(e,t){1&e&&(o.Qc(0,qe,45,15,"ng-container",0),o.sc(1,"async")),2&e&&o.yc("ngIf",o.tc(1,1,t.rule$))},directives:[c.t,v.q,v.m,w.b,v.g,fe.c,fe.a,y.a,w.d,w.a,k.b,v.c,v.l,v.f,ge.a,ge.c,_.a,U.b,U.a,Be,Oe.b,M.a],pipes:[c.b,c.k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}"]}),e})()}];let Je=(()=>{class e{}return e.\u0275mod=o.Yb({type:e}),e.\u0275inj=o.Xb({factory:function(t){return new(t||e)},imports:[[i.l.forChild(Ke)],i.l]}),e})();var We=n("Hhmg"),Xe=n("DTEk");let Ye=(()=>{class e{}return e.\u0275mod=o.Yb({type:e}),e.\u0275inj=o.Xb({factory:function(t){return new(t||e)},imports:[[c.c,v.o,Je,u.d,We.a,Xe.a]]}),e})()}}]);